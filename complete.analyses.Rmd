---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
```{r}
baseline.isolates <- c(1, 8, 12, 20, 21, 74, 87, 118, 123, 129, 449, 461, 467, 475, 558, 564, 568, 581, 645, 667, 800)

survey.isolates <-  c( 2385, 2386, 2098, 2099, 2100, 2139, 2140, 2143, 2220, 2222, 2223, 2320, 2362, 2388, 2390 )

Farmer.fields <- c(136:442, 455, 456, 466, 468, 470, 471, 478:554, 602:610, 612:635, 671, 672, 682:690, 695:797, 810:823, 834, 835, 848:1024, 1255: 1326, 1491: 1500, 1661:1670, 1831: 2246, 2303: 2342,2362: 2381, 2393: 2573)

baseline.isolates.2 <- c(1: 136, 444: 454, 457: 465, 467, 469, 472:477, 555:601, 611, 636:670, 673: 680, 691:694 , 798: 809,  824: 833, 836: 847)

drybean <- c(1, 5, 12,13:118, 123:128, 133:135, 145, 146, 152, 155:160, 182: 185, 194:200, 205, 220, 223, 248, 253:255, 274, 279, 280, 290, 294, 304: 309, 323, 358, 393, 395, 396, 397, 400:402, 405, 408, 409, 434, 443:465, 467, 469: 493, 495:505, 555:613, 615: 760, 762: 819, 824:833, 835:855, 858:921, 966: 971, 980, 981, 985: 996, 998: 1009, 1220:1225 , 1857: 1940, 2242: 2569)

soybean <- c(143, 147, 181, 187, 188, 189,202, 257: 259, 264:268, 276, 281, 289, 293, 295, 310 , 399, 412:417, 419, 425:427, 439, 440, 494, 506:554, 834, 972:979, 982, 997, 1010: 1022, 1025:1219, 1229: 1856, 1941: 2241 )

SI.Production.Field <- c( 698:741, 743:744, 746:760, 762: 778, 
786: 797, 810:819, 848: 855, 858: 914)

SI.Screening.Nursery.Field <- c(444:454, 457:465, 467, 469, 472:477, 555: 582, 584: 601, 611, 636:670, 673:681,691:694, 798:809, 824: 833 , 836:847)# also taking into account WM Monitor 

```

```{r functions}
#Getrange function
get_range <- function(mynumber) {
  bb <- boxplot.stats(mynumber)
  cc <- bb$stats
  dd <- max(cc)
  ee <- min(cc)
  return(data.frame(upper = dd, lower = ee))
}

##Function.Reading data for serial.dilution
reading_data_serial_dilution <- function(filename){
  data <-
  read.csv(filename)
 # data <- subset(dareading_data("data/Benomyl.Colletotrichum.csv")ta, select = -X)
  data$repeats <- rep_len(1:4, length.out = nrow(data))
  
   # renaming ID for the current names
 data$ID[ data$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74, the one what I used was specifically this:74SS1
 data$ID[ data$ID =="74SS1"]  <- "74" 
 data$ID[ data$ID =="62-02"]  <- "2098" 
 data$ID[ data$ID =="62-03"]  <- "2099" 
 data$ID[ data$ID =="62-04"]  <- "2100" 
 data$ID[ data$ID =="78-01"]  <- "2139" 
 data$ID[ data$ID =="78-02"]  <- "2140" 
 data$ID[ data$ID =="78-05"]  <- "2143" 
 data$ID[ data$ID =="S-01"]  <- "2320" 
 data$ID[ data$ID =="H-01"]  <- "2220" 
 data$ID[ data$ID =="H-03"]  <- "2222" 
 data$ID[ data$ID =="H-04"]  <- "2223"
 data$ID[ data$ID =="I-20"]  <- "2362"
 data$ID[ data$ID =="419"]  <- "2385"
 data$ID[ data$ID =="413"]  <- "2386"
 data$ID[ data$ID =="W212"]  <- "2388"
 data$ID[ data$ID =="318"]  <- "2390"
 data$ID[data$ID == "54C"]  <- "2453"
 data$ID[data$ID == "65B"]  <- "2528"
 data$ID[data$ID == "51C"]  <- "2449"
 data$ID[data$ID == "71B"]  <- "2505"
 data$ID[data$ID == "64D"]  <- "2518"
 data$ID[data$ID == "53B"]  <- "2536"
 data$ID[data$ID == "60A"]  <- "2559"
 data$ID[data$ID == "H-01"]  <- "2220"
 data$ID[data$ID == "H-03"]  <- "2222"
 data$ID[data$ID == "419"]  <- "2385"
 data$ID[data$ID == "78-02"]  <- "2140"

 
 
 
 data$ID <- as.numeric(data$ID)
  data <- data %>%
         mutate(polar= replace(polar, polar == 0, 0.6)) %>%  #replacing 0 cm growth for the size of plug that is 0.6
    mutate(ecuatorial= replace(ecuatorial, ecuatorial == 0, 0.6)) %>% #replacing 0 cm growth for the size of plug that is 0.6
    # group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
    mutate(growth = ((ecuatorial + polar) / 2)) %>% 
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>% 
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>%
  ungroup() %>%
  select(c(ID, experimental_replicate, repeats, dose, response))
  
  
  
  }


##Function.Reading data for Discriminatory concentration
reading_data_discriminatory_concentration <- function(filename) {
  data <- filename
  # data <- subset(data, select = -X)
  #data$repeats <- rep_len(1:3, length.out = nrow(data))
  # renaming ID for the current names
  data$ID[data$ID == "12B"]  <- "12"
  #Although 74SS1 belong to # 74, the one what I used was specifically this:74SS1
  data$ID[data$ID == "74SS1"]  <- "74"
  data$ID[data$ID == "62-02"]  <- "2098"
  data$ID[data$ID == "62-03"]  <- "2099"
  data$ID[data$ID == "62-04"]  <- "2100"
  data$ID[data$ID == "78-01"]  <- "2139"
  data$ID[data$ID == "78-02"]  <- "2140"
  data$ID[data$ID == "78-05"]  <- "2143"
  data$ID[data$ID == "S-01"]  <- "2320"
  data$ID[data$ID == "H-01"]  <- "2220"
  data$ID[data$ID == "H-03"]  <- "2222"
  data$ID[data$ID == "H-04"]  <- "2223"
  data$ID[data$ID == "I-20"]  <- "2362"
  data$ID[data$ID == "419"]  <- "2385"
  data$ID[data$ID == "413"]  <- "2386"
  data$ID[data$ID == "W212"]  <- "2388"
  data$ID[data$ID == "318"]  <- "2390"
  data$ID[data$ID == "54C"]  <- "2453"
  data$ID[data$ID == "65B"]  <- "2528"
  data$ID[data$ID == "51C"]  <- "2449"
  data$ID[data$ID == "71B"]  <- "2505"
  data$ID[data$ID == "64D"]  <- "2518"
  data$ID[data$ID == "53B"]  <- "2536"
  data$ID[data$ID == "60A"]  <- "2559"
  data$ID[data$ID == "H-01"]  <- "2220"
  data$ID[data$ID == "H-03"]  <- "2222"
  data$ID[data$ID == "419"]  <- "2385"
  data$ID[data$ID == "78-02"]  <- "2140"
  data$ID <- as.numeric(data$ID)
  data <- data %>%
    mutate(response = replace(response, response == 0, 0.6)) %>%
    #replacing 0 cm growth for the size of plug that is 0.6
    # group_by(ID, experimental_replicate, concentration, growth, repeats) %>%
    group_by(ID) %>%
    mutate(response_range = list(get_range(response))) %>%
    unnest() %>%
    mutate(control_range = list(get_range(control))) %>%
    unnest() %>%
    filter(response <= upper &
             response >= lower,
           control <= upper1 & control >= lower1) %>%
    ungroup() %>%
    select(c(ID, experimental_replicate, repeats, response, control)) %>%
    group_by(ID) %>% mutate(count = n()) %>% ungroup() %>%  mutate(experiment = ifelse(count <= 6, 1, 2))
  }
#getting EC50
getting_EC50 <- function(filename){
  
  getting.EC50 <- EC_table(filename, form = response ~ dose)
getting.EC50 <- getting.EC50 %>% 
  rename(ID = sample ) %>% # renaming
 # mutate(ID = as.factor(ID)) %>% 
  rename(EC50 = Estimate.50) %>%
   group_by(ID, EC50) %>%
  mutate(group = ifelse(
    ID %in% baseline.isolates,# if they are in this group
    "baseline",
    ifelse(
      ID %in% survey.isolates, # if they are in this group, that is named farmer fiels also ahead
      "survey_isolates",
      "treatmentyear2016_isolates" # if they are in this group, that is named fungicide field trials also ahead
      ))) %>% ungroup() %>% 
      mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group)) %>% 
  ungroup()
}
##
getting_DC <- function(filename){
   data <-filename
  
  data1<- data %>% group_by(ID, dose) %>% summarise(mean_response = mean(response, na.rm = TRUE)) %>%
    ungroup() %>% 
  spread(dose, mean_response) %>% 
    rename(control = `0`)
    
    
  data2 <- as_data_frame( lapply(data1,function(x) {x[1] ; x}))
  # data3 <- data.frame(data2)
  # data4 <-  lapply(data3,name <- function(variables) {
  # })
  
  colnames(data2)[-c(1:2)] <- paste("RG_", colnames(data2[,-c(1:2)]), sep = "")
  data3 <- data2 %>% mutate_each(funs((./control)*100), starts_with("RG_")) %>% 
    select(-c(control)) 
} 
##
  getting_DC_2 <- function(filename){
   data <-filename
  
data1 <-data %>% #joining
  # normalizing data
  mutate(logEC50 = (log(EC50))) #%>% 
#rename(Estimate.50 = EC50)# #Since here EC50 is known as Estimate EC50 from EC50 table maybe I dont ahve to change it
  
  
  }
#   
#   make.power <- function(n) {
#  pow <- function(x) {
#  x^n
#  }
#  pow
# }
  lineal_model <- function (vardep, varindep, data) {
    lm(paste(vardep, "~", varindep), data = data)
  }


  # getting__<- function(filename){
  # lineal_model <- function (vardep, varindep, data) {
  #   lm(paste(vardep, "~", varindep), data = data)
  # }
  # a <- lineal_model(vardep,varindep, data=filename)
  # data <-filename
  # data1<- data %>% mutate(Estimate.50DC =
  #                                     #using the model the intercept and the coefficient of the model
  #                                     exp(a[[1]][[1]] + a[[1]][[2]] * varindep)) %>%
  #   # here I need to do this dynamic
  #   select(ID, Estimate.50DC, Estimate.50)
  # }
  # 
  # getting__ <- function(filename){
  #  data <-filename
  # data1<- data %>% mutate 
  # data1<- data %>% final.boscalid.clean %>% mutate(Estimate.50DC =
  #                                     #using the model the intercept and the coefficient of the model
  #                                     exp(finalRG0.2[[1]][[1]] + finalRG0.2[[1]][[2]] * RG0.2))
  #   
  #  
  wrangling_DC<- function(filename){
   data <-filename
  
data1 <-data %>% 
 mutate(source = ifelse(
    ID %in% baseline.isolates.2,
    "Baseline",
    ifelse(
      ID %in% Farmer.fields,
      "Producer Fields","Fungicide Field Trials"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host")))  %>%
  mutate(
  source = as.factor(source),
  Host = as.factor(Host)) %>% 
#taking out "different host" becuse does not belong to drybean nor soybean
  filter(!ID == 8, !ID == 129)
}
##wrangling survey to get the EC50DC
  wrangling_survey <- function(filename) {
    data <- filename
    data1 <- data %>%
      group_by(ID, experiment) %>% # It was added here experiment because there are more repetatiosn ID in prurpose as cpositive controsl and non in purpose
      summarise(
        mean_response = mean(response, na.rm = TRUE),
        mean_control = mean(control, na.rm = TRUE)
      ) %>% ungroup() %>%
      mutate(RG = (mean_response / mean_control) * 100)
  }

    
  

```

```{r Reading data}
#TM
hey <-
  reading_data_serial_dilution("data/TM_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv") %>%
  filter(!experimental_replicate == 1 |
           !dose == 1.5 | !repeats == 3)  #something weird happened with the repeats 3 so Iam revoming those
#Check here because there are more repeats for control, in that case create a new variable or column
## First try with postdoc Thomas
survey.TM.thomas <- read.csv("data/DD_survey-WMNCSRP.csv") %>%
  select(
    ID,
    repeats,
    experimental_replicate,
    TM.ecuatorial,
    TM.polar,
    control.ecuatorial,
    control.polar
  ) %>%
  mutate(TM.growth = ((TM.ecuatorial + TM.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = TM.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


## Second try with Edgar
survey.TM.USA <- 
      read.csv("data/DD_survey-WMNCSRP_TM.csv") %>% 
mutate(TM.growth = ((TM.ecuatorial + TM.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = TM.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()

## Third try with Cristian
survey.TM.more.USA <- 
 read.csv("data/TM.Cristian.csv") %>% 
mutate(TM.growth = ((TM.ecuatorial + TM.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = TM.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


# Fourth try with Edgar # it does not exist yet
# survey.TM.MX.BZ <-
#  read.csv("data/DD_survey-WMNCSRP_TM.Brazilian.Mexican.csv") %>% mutate(TM.growth = ((TM.ecuatorial + TM.polar) / 2),
#          control.growth = ((control.ecuatorial + control.polar) / 2)) %>%
# rename(response = TM.growth, control = control.growth) %>%
#   select(c(ID, experimental_replicate, repeats, response, control)) %>% 
# reading_data_discriminatory_concentration()



#Tetraconazole
hey2 <- reading_data_serial_dilution("data/tetraconazole_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
## First try with postdoc Thomas
survey.tetraconazole.thomas <- read.csv("data/DD_survey-WMNCSRP.csv") %>%
  select(
    ID,
    repeats,
    experimental_replicate,
    tetraconazole.ecuatorial,
    tetraconazole.polar,
    control.ecuatorial,
    control.polar
  ) %>%
  mutate(tetraconazole.growth = ((tetraconazole.ecuatorial + tetraconazole.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = tetraconazole.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()

## Second try with Edgar
survey.tetraconazole.USA <- 
      read.csv("data/DD_survey-WMNCSRP_tetraconazole.csv") %>% 
mutate(tetraconazole.growth = ((tetraconazole.ecuatorial + tetraconazole.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = tetraconazole.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


## Third try with Cristian
survey.tetraconazole.more.USA <- 
 read.csv("data/tetraconazole.Cristian.csv") %>% 
mutate(tetraconazole.growth = ((tetraconazole.ecuatorial + tetraconazole.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = tetraconazole.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>%  
reading_data_discriminatory_concentration()

## Fourth try with Edgar 
survey.tetraconazole.MX.BZ <- 
 read.csv("data/DD_survey-WMNCSRP_tetraconazole.Mexican.Brazilian.csv") %>% mutate(tetraconazole.growth = ((tetraconazole.ecuatorial + tetraconazole.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = tetraconazole.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


#Boscalid
hey3 <- reading_data_serial_dilution("data/boscalid_serialdilution_baseline(validationdata).csv") %>% filter(!dose ==  0.4 & !ID == 800)
## First try with postdoc Thomas
survey.boscalid.thomas <- read.csv("data/DD_survey-WMNCSRP.csv") %>%
  select(
    ID,
    repeats,
    experimental_replicate,
    boscalid.ecuatorial,
    boscalid.polar,
    control.ecuatorial,
    control.polar
  ) %>%
  mutate(boscalid.growth = ((boscalid.ecuatorial + boscalid.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = boscalid.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


   ## Second try with Edgar
survey.boscalid.USA <- 
      read.csv("data/DD_survey-WMNCSRP_boscalid.csv") %>% 
mutate(boscalid.growth = ((boscalid.ecuatorial + boscalid.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = boscalid.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


 ## Third try with Cristian
survey.boscalid.more.USA <- 
 read.csv("data/Boscalid.Cristian.csv") %>% 
mutate(boscalid.growth = ((boscalid.ecuatorial + boscalid.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = boscalid.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


## Fourth try with Edgar 
survey.boscalid.MX.BZ <- 
 read.csv("data/DD_survey-WMNCSRP_boscalid.Brazilian.Mexican.csv") %>% mutate(boscalid.growth = ((boscalid.ecuatorial + boscalid.polar) / 2),
         control.growth = ((control.ecuatorial + control.polar) / 2)) %>% 
rename(response = boscalid.growth, control = control.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


# #Picoxystrobin
hey4 <- reading_data_serial_dilution("data/picoxystrobin_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
## First try with postdoc Thomas
survey.picoxystrobin.thomas <- read.csv("data/DD_survey-WMNCSRP.csv") %>%
  select(
    ID,
    repeats,
    experimental_replicate,
    picoxystrobin.ecuatorial,
    picoxystrobin.polar,
     sham.ecuatorial,
    sham.polar
  ) %>%
  mutate(picoxystrobin.growth = ((picoxystrobin.ecuatorial + picoxystrobin.polar) / 2),
         sham.growth = ((sham.ecuatorial + sham.polar) / 2)) %>% 
rename(response = picoxystrobin.growth, control = sham.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
reading_data_discriminatory_concentration()
 
## Second try with Edgar
survey.picoxystrobin.USA <- 
      read.csv("data/DD_survey-WMNCSRP_picoxystrobin.csv") %>% 
mutate(picoxystrobin.growth = ((picoxystrobin.ecuatorial + picoxystrobin.polar) / 2),
         sham.growth = ((sham.ecuatorial + sham.polar) / 2)) %>% 
rename(response = picoxystrobin.growth, control = sham.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
  reading_data_discriminatory_concentration()


## Third try with Cristian
survey.picoxystrobin.more.USA <- 
 read.csv("data/picoxystrobin.Cristian.csv") %>% 
mutate(picoxystrobin.growth = ((picoxystrobin.ecuatorial + picoxystrobin.polar) / 2),
         sham.growth = ((sham.ecuatorial + sham.polar) / 2)) %>% 
rename(response = picoxystrobin.growth, control = sham.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) 

survey.picoxystrobin.more.USA.2 <- reading_data_discriminatory_concentration(survey.picoxystrobin.more.USA)
## Fourth try with Edgar 
survey.picoxystrobin.MX.BZ <- 
 read.csv("data/DD_survey-WMNCSRP_picoxystrobin.Mexican.Brazilian.csv") %>% mutate(picoxystrobin.growth = ((picoxystrobin.ecuatorial + picoxystrobin.polar) / 2),
         sham.growth = ((sham.ecuatorial + sham.polar) / 2)) %>% 
rename(response = picoxystrobin.growth, control = sham.growth) %>% 
  select(c(ID, experimental_replicate, repeats, response, control)) %>% 
 reading_data_discriminatory_concentration()




```
```{r getting EC50 serial dilution}
# TM
TM.EC50 <-  getting_EC50(hey)
# Tetraconazole
tetraconazole.EC50 <- getting_EC50(hey2)
# Boscalid
boscalid.EC50 <- getting_EC50(hey3)
#Picoxystrobin
picoxystrobin.EC50 <- getting_EC50(hey4)
```

```{r Getting Discriminatory dose}
#getting_EC50 releases ID with factor
TM <- getting_DC(hey) 
  TM.joined <-  TM %>% left_join(TM.EC50)
  
TM.joined.2 <-  getting_DC_2(TM.joined) 
  
  #Boscalid
boscalid <- getting_DC(hey3) 
  boscalid.joined <-  boscalid%>% left_join(boscalid.EC50)
  
 boscalid.joined.2 <-  getting_DC_2(boscalid.joined) 
 ###Dose chosen as DC. Although there is one dose with higher r2, there is no difference between and this was selected
# Linear model of log EC50 and relative growth at 0.2 ppm, check normality and homogeneity of variances
finalRG_0.2 <- lm(logEC50 ~ RG_0.2,  boscalid.joined.2)
summary(finalRG_0.2)
#plot(finalRG0.2)

##taking out outliers from Q-Q PLOT $ LEVERAGE TEST, ISOLATES # 1032 from treatment, 2222 & 2223 from Farmer fields##
boscalid.joined.2.clean <-
  boscalid.joined.2 %>% filter(!ID == "1032", !ID == "2222",!ID == "2223") #%>% 
  # select(logEC50, RG_0.2) %>% 
  # rename(RG = RG_0.2)

summary(boscalid.lm <- lineal_model("logEC50","RG_0.2",data =  boscalid.joined.2.clean))
   # Getting the EC50DC according to the model
boscalid.EC50DC <- boscalid.joined.2.clean %>% mutate(Estimate.50DC =
                                     #using the model the intercept and the coefficient of the model
                                    exp(boscalid.lm[[1]][[1]] + boscalid.lm[[1]][[2]] * RG_0.2)) %>%# here I need to do this dynamic
  select(ID, Estimate.50DC, EC50) %>%  wrangling_DC()


  
  
  
  # Linear Regression graph of log EC50 and relative growth at 0.2 ppm

 fig.1 <-    ggplot(boscalid.lm, aes(x = RG_0.2, y = logEC50)) +  geom_point() + geom_smooth(method = "lm") +  theme(
    plot.title = element_text(
    size = 8,
    face = "bold",
    hjust = 0.5,
    family = "Arial"
    ),
    axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
    axis.text = element_text(
    face = "bold",
    size = 14,
    family = "Arial"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
    ) + labs(title = "Linear regression between EC50 values & relative growth of Boscalid at 0.2 ppm", x =
    "Relative growth (%)", y = "Log EC50")
    


    # Linear model of EC50  and EC50DC just to corroborate is a GOOD RELATIONSHIP, check normality and homogeneity of variances
summary(boscalid.lm.both.EC50s <- lineal_model("Estimate.50DC","EC50",data =  boscalid.EC50DC))

#pdf("Linear regression of boscalid 0.2 ppm.pdf")  
fig.2<- ggplot(boscalid.lm.both.EC50s, aes(x = EC50, y = Estimate.50DC)) +  theme(
  plot.title = element_text(
  size = 8,
  face = "bold",
  hjust = 1,
  family = "Arial"
  ),
  axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
  axis.text = element_text(
  face = "bold",
  size = 14,
  family = "Arial"
  ),
  panel.background = element_rect(fill = "white", colour = "grey50")
  ) + labs(title = "Linear regression between EC50 and EC50(D) values of Boscalid ", x =
  "EC50 (ppm)", y = "EC50(D) (ppm)") + geom_point(shape = 24) + geom_smooth(method = "lm")

  
  ### Wrangling EC50DC

# boscalid.EC50DC.2 <- wrangling_DC(boscalid.EC50DC)
  
```

```{r Using the DC and the model, echo = FALSE}
#Boscalid
#survey.boscalid <- bind_rows(survey.boscalid.thomas, survey.boscalid.USA,survey.boscalid.more.USA,survey.boscalid.MX.BZ) 

#any particular case check so far by this way
survey.boscalid.thomas.2 <- survey.boscalid.thomas %>% mutate(
    experiment = case_when(
      response == 1.775 |
        response == 1.905 |
        response == 1.980 |
        response == 1.910 |
        response == 1.660 | 
        response == 1.885~ 2,
      TRUE ~ 1))


survey.boscalid.thomas.3 <- wrangling_survey(survey.boscalid.thomas.2) %>%
  mutate(EC50DC = exp (boscalid.lm [[1]][[1]] + boscalid.lm[[1]][[2]] * RG))# exponential is the opposite of log
        #using the model the intercept and the coefficient of the model
##
survey.boscalid.USA.2 <- survey.boscalid.USA %>% mutate(
    experiment = case_when(
      response == 2.0635 |
        control == 5.4735 |
        response == 2.2900 |
        response == 2.1965 |
        response == 2.4830 | 
        control == 5.5380 ~ 2,
      TRUE ~ 1))

survey.boscalid.USA.3 <- wrangling_survey(survey.boscalid.USA.2) %>%
  mutate(EC50DC = exp (boscalid.lm [[1]][[1]] + boscalid.lm[[1]][[2]] * RG))#

##
survey.boscalid.more.USA <- survey.boscalid.more.USA %>% mutate(response = (response/10), control = (control/10))



# survey.boscalid.more.USA.2 <- survey.boscalid.more.USA %>% mutate(
#   experiment = ifelse(
#     response == 1.6570 |
#       response == 1.6735  |
#       response == 1.6910 |
#       response == 1.8705 |
#       response == 2.1945 |
#       response == 2.0860,
#     1,
#     2
#   )
# )

survey.boscalid.more.USA.2 <-
  survey.boscalid.more.USA %>% mutate(
    experiment = ifelse(
      response == 1.6570 |
        response == 1.6735  |
        response == 1.6910 |
        response == 1.8705 |
        response == 2.1945 |
        response == 2.0860,
      1,
      ifelse(
        response == 1.9390 |
          response ==  1.9865 |
          response ==  1.7995 |
          response ==  1.9625 |
          response ==  1.9140 |
          response ==  1.7965,
        3,
        ifelse(
          response ==  1.9400 |
            response ==  2.1380 |
            response ==  2.1775 |
            response ==  2.2110 |
            response ==  2.5435,
          4,
          ifelse(
            response ==  1.9800 |
              response ==  2.1390 |
              response ==  2.1840 |
              response ==  2.0815 |
              response ==  1.9240 |
              response ==  1.8405,
            5,
            experiment
          )
        )
        
      )
    )
  )

 survey.boscalid.more.USA.3 <-
  survey.boscalid.more.USA %>% mutate(           
  experiment = case_when(
      response == 1.6570 |
        response ==1.6735  |
        response == 1.6910 |
        response == 1.8705 |
        response == 2.1945 |
        response == 2.0860  ~ 2,
      response == 1.9390 |
        response ==  1.9865|
        response ==  1.7995|
        response ==  1.9625|
        response ==  1.9140| 
         response ==  1.7965 ~ 3,
         response ==  1.9400|
        response ==  2.1380|
        response ==  2.1840|
        response ==  2.0815|
        response ==  1.9240| 
         response ==  1.8405 ~ 4,
      response ==  1.9800 |
              response ==  2.1390 |
              response ==  2.1840 |
              response ==  2.0815 |
              response ==  1.9240 |
              response ==  1.8405~5,
        TRUE ~ 1))
      

survey.boscalid.more.USA.4 <- wrangling_survey(survey.boscalid.more.USA.2) %>%
  mutate(EC50DC = exp (boscalid.lm [[1]][[1]] + boscalid.lm[[1]][[2]] * RG))#
##

survey.boscalid.MX.BZ.2 <- wrangling_survey(survey.boscalid.MX.BZ) %>%
  mutate(EC50DC = exp (boscalid.lm [[1]][[1]] + boscalid.lm[[1]][[2]] * RG))#
       
#Gathering 
survey.boscalid <- bind_rows(survey.boscalid.thomas.3,
                             survey.boscalid.USA.3,
                             survey.boscalid.more.USA.4,
                             survey.boscalid.MX.BZ.2)
                             
                             
           
# Tetraconazole



```

```{r}
survey.boscalid.thomas %>% group_by(ID) %>% tally()
View(
  survey.boscalid.thomas %>% group_by(ID) %>% mutate(count = n()) %>% ungroup() %>%  mutate(experiment = ifelse(count <= 6, 1, 2)) %>% mutate(
    experiment = case_when(
      response == 1.775 |
        response == 1.905 |
        response == 1.980 |
        response == 1.910 |
        response == 1.660 | 
        response == 1.885 | 
        response == 1.775 ~ 1,
      TRUE ~ 2)))
  

```

