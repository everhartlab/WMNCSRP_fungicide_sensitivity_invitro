---
title: "R Notebook"
output: html_notebook
---

 

```{r}
library(tidyverse)
library(ggplot2)
library(ezec)
#library(NRES803)
library(broom)
library(ggridges)
library(cowplot)
library(gridExtra)
library(kableExtra)
library(arsenal)
library(DescTools)

knitr::opts_chunk$set(echo = TRUE)
```


```{r read_data}
##  Reading and subsetting data 
boscalid.data <-
  read.csv("data/boscalid_serialdilution_baseline(validationdata).csv")
  boscalid.data <- subset(boscalid.data, select = -X)
  boscalid.data$repeats <- rep_len(1:4, length.out = nrow(boscalid.data))
  boscalid.data$ID <- as.character(boscalid.data$ID)
  # renaming ID for the current names
 boscalid.data$ID[ boscalid.data$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74 the hat I used was specifically this, 74SS1
 boscalid.data$ID[ boscalid.data$ID =="74SS1"]  <- "74" 
 boscalid.data$ID[ boscalid.data$ID =="62-02"]  <- "2098" 
 boscalid.data$ID[ boscalid.data$ID =="62-03"]  <- "2099" 
 boscalid.data$ID[ boscalid.data$ID =="62-04"]  <- "2100" 
 boscalid.data$ID[ boscalid.data$ID =="78-01"]  <- "2139" 
 boscalid.data$ID[ boscalid.data$ID =="78-02"]  <- "2140" 
 boscalid.data$ID[ boscalid.data$ID =="78-05"]  <- "2143" 
 boscalid.data$ID[ boscalid.data$ID =="S-01"]  <- "2320" 
 boscalid.data$ID[ boscalid.data$ID =="H-01"]  <- "2220" 
 boscalid.data$ID[ boscalid.data$ID =="H-03"]  <- "2222" 
 boscalid.data$ID[ boscalid.data$ID =="H-04"]  <- "2223"
 boscalid.data$ID[ boscalid.data$ID =="I-20"]  <- "2362"
 boscalid.data$ID[ boscalid.data$ID =="419"]  <- "2385"
 boscalid.data$ID[ boscalid.data$ID =="413"]  <- "2386"
 boscalid.data$ID[ boscalid.data$ID =="W212"]  <- "2388"
 boscalid.data$ID[ boscalid.data$ID =="318"]  <- "2390"

  ####Transforming to $ID to numeric
 boscalid.data$ID <- as.numeric(boscalid.data$ID)
 ## Discarding dose at 0.4 ppm and isolate 800 because it has just one experimental replication ##
 # Filter out the control observations that have less than 5 cm growth
  boscalid.data <- boscalid.data %>%
    filter(!dose ==  0.4 & !ID == 800) %>%
    group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
    filter(
    !ID == 2362 |
    !experimental_replicate == 2 |
    !dose == 0 |
    !repeats == 3 ,
    !ID == 1033 |
    !experimental_replicate == 2 | 
    !dose == 0 |
    !repeats == 4
    ) %>%
    mutate(growth = ((ecuatorial + polar) / 2))
    
#Reading and subsetting data picoxystrobin
  picoxystrobin.data <-
    read.csv("data/picoxystrobin_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
    picoxystrobin.data$repeats <- rep_len(1:4, nrow(picoxystrobin.data))
    picoxystrobin.data$ID <- as.character(picoxystrobin.data$ID)
    # renaming ID for the current names
    
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74 the that I used was specifically this, 74SS1
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="74SS1"]  <- "74" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="62-02"]  <- "2098" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="62-03"]  <- "2099" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="62-04"]  <- "2100" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="78-01"]  <- "2139" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="78-02"]  <- "2140" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="78-05"]  <- "2143" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="S-01"]  <- "2320" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="H-01"]  <- "2220" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="H-03"]  <- "2222" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="H-04"]  <- "2223"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="I-20"]  <- "2362"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="419"]  <- "2385"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="413"]  <- "2386"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="W212"]  <- "2388"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="318"]  <- "2390"

   ####Transforming to $ID to numeric
picoxystrobin.data$ID <- as.numeric(picoxystrobin.data$ID)
   
  #Filter out the control observations that have less than 5 cm growth
    picoxystrobin.data <- picoxystrobin.data %>%
      group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
      filter(
      !ID == 2143 |
      !experimental_replicate == 1 |
      !dose == 0 |
      !repeats == 2 ,
      !ID == 2100 |
      !experimental_replicate == 2 |
      !dose == 0 |
      !repeats == 3,
      !ID == 2223 |
      !experimental_replicate == 2 | !dose == 0 | !repeats == 2
      ) %>%
      mutate(growth = ((ecuatorial + polar) / 2))
      
#Reading and subsetting data tetraconazole
tetraconazole.data <-
  read.csv("data/tetraconazole_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
  tetraconazole.data <- subset(tetraconazole.data, select = -(X:X.1))
  tetraconazole.data$repeats <- rep_len(1:4, length.out = nrow(tetraconazole.data))
  tetraconazole.data$ID <- as.character(tetraconazole.data$ID) 
  # renaming ID for the current names
 tetraconazole.data$ID[ tetraconazole.data$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74 the hat I used was specifically this, 74SS1
 tetraconazole.data$ID[ tetraconazole.data$ID =="74SS1"]  <- "74" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="62-02"]  <- "2098" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="62-03"]  <- "2099" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="62-04"]  <- "2100" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="78-01"]  <- "2139" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="78-02"]  <- "2140" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="78-05"]  <- "2143" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="S-01"]  <- "2320" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="H-01"]  <- "2220" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="H-03"]  <- "2222" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="H-04"]  <- "2223"
 tetraconazole.data$ID[ tetraconazole.data$ID =="I-20"]  <- "2362"
 tetraconazole.data$ID[ tetraconazole.data$ID =="419"]  <- "2385"
 tetraconazole.data$ID[ tetraconazole.data$ID =="413"]  <- "2386"
 tetraconazole.data$ID[ tetraconazole.data$ID =="W212"]  <- "2388"
 tetraconazole.data$ID[ tetraconazole.data$ID =="318"]  <- "2390"

    ####Transforming to $ID to numeric
tetraconazole.data$ID <- as.numeric(tetraconazole.data$ID)
   # Filter out the control observations that have less than 5 cm growth
  tetraconazole.data <- tetraconazole.data %>%
    group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
    filter(
    !ID == 2139 |
    !experimental_replicate == 1 |
    !dose == 0.5 ,
    !ID == 2139 |
    !experimental_replicate == 1 |
    !dose == 1 ,
    !ID == 2139 |
    !experimental_replicate == 1 | !dose == 2,
    !ID == 2139 |
    !experimental_replicate == 1 | !dose == 3,
    !ID == 2139 |
    !experimental_replicate == 1 | !dose == 5
    )   %>%
    mutate(growth = ((ecuatorial + polar) / 2))
#Reading and subsetting data TM
  TMdata <-
    read.csv("data/TM_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
    TMdata <- subset(TMdata, select = -(X:X.6))
    TMdata$repeats <- rep_len(1:4, length.out = nrow(TMdata))
    TMdata$ID <- as.character(TMdata$ID)
   # renaming ID for the current names
  TMdata$ID[ TMdata$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74 the hat I used was specifically this, 74SS1
  TMdata$ID[ TMdata$ID =="74SS1"]  <- "74" 
 TMdata$ID[ TMdata$ID =="62-02"]  <- "2098" 
 TMdata$ID[ TMdata$ID =="62-03"]  <- "2099" 
 TMdata$ID[ TMdata$ID =="62-04"]  <- "2100" 
 TMdata$ID[ TMdata$ID =="78-01"]  <- "2139" 
 TMdata$ID[ TMdata$ID =="78-02"]  <- "2140" 
 TMdata$ID[ TMdata$ID =="78-05"]  <- "2143" 
 TMdata$ID[ TMdata$ID =="S-01"]  <- "2320" 
 TMdata$ID[ TMdata$ID =="H-01"]  <- "2220" 
 TMdata$ID[ TMdata$ID =="H-03"]  <- "2222" 
 TMdata$ID[ TMdata$ID =="H-04"]  <- "2223"
 TMdata$ID[ TMdata$ID =="I-20"]  <- "2362"
 TMdata$ID[ TMdata$ID =="419"]  <- "2385"
 TMdata$ID[ TMdata$ID =="413"]  <- "2386"
 TMdata$ID[ TMdata$ID =="W212"]  <- "2388"
 TMdata$ID[ TMdata$ID =="318"]  <- "2390"

 ####Transforming to $ID to numeric
TMdata$ID <- as.numeric(TMdata$ID)   
  #Filter out the control observations that have less than 5 cm growth
    TMdata <- TMdata %>%
      group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
      filter(!experimental_replicate == 1 |
      !dose == 1.5 | !repeats == 3) %>% # something weird happened with the peats 3 so Iam revoming those
      mutate(growth = ((ecuatorial + polar) / 2))
      
#Reading and subsetting data discriminatory dose use
    survey.data <-  read.csv("data/DD_survey-WMNCSRP.csv")
    survey.data <- survey.data %>%
    group_by(
    ID,
    repeats,
    experimental_replicate,
    sham.ecuatorial,
    sham.polar,
    picoxystrobin.ecuatorial,
    picoxystrobin.polar,
    boscalid.ecuatorial,
    boscalid.polar,
    tetraconazole.ecuatorial,
    tetraconazole.polar,
    TM.ecuatorial,
    TM.polar,
    control.ecuatorial,
    control.polar
    ) %>%
    mutate(
    sham.growth = ((sham.ecuatorial + sham.polar) / 2),
    picoxystrobin.growth = ((
    picoxystrobin.ecuatorial + picoxystrobin.polar
    ) / 2),
    boscalid.growth = ((boscalid.ecuatorial + boscalid.polar) / 2),
    tetraconazole.growth = ((
    tetraconazole.ecuatorial + tetraconazole.polar
    ) / 2),
    TM.growth = ((TM.ecuatorial + TM.polar) / 2),
    control.growth = ((control.ecuatorial + control.polar) / 2)
    ) %>%
    ungroup()
    
    survey.data.2 <- survey.data
     survey.data.2$ID <- as.character(survey.data.2$ID)
     # renaming ID for the current names
     survey.data.2$ID[ survey.data.2$ID =="54C"]  <- "2453"
     survey.data.2$ID[ survey.data.2$ID =="65B"]  <- "2528"
      survey.data.2$ID[ survey.data.2$ID =="51C"]  <- "2449"
       survey.data.2$ID[ survey.data.2$ID =="71B"]  <- "2505"
        survey.data.2$ID[ survey.data.2$ID =="64D"]  <- "2518"
         survey.data.2$ID[ survey.data.2$ID =="53B"]  <- "2536"
          survey.data.2$ID[ survey.data.2$ID =="60A"]  <- "2559"
           survey.data.2$ID[ survey.data.2$ID =="H-01"]  <- "2220"
            survey.data.2$ID[ survey.data.2$ID =="H-03"]  <- "2222"
             survey.data.2$ID[ survey.data.2$ID =="419"]  <- "2385"
              survey.data.2$ID[ survey.data.2$ID =="78-02"]  <- "2140"

             survey.data.3 <- survey.data.2 %>% mutate(ID = as.numeric(ID))
# reading the inventory Sclerotinia collection
                            WM <- read.csv("data/WM-fixingproductnamesID2573_modifyingforactiveingredient_8.csv", stringsAsFactors = TRUE)
WM$Collection_ID <- str_squish(WM$Collection_ID)
# removing those isolates that are repated and have subsequent ID number becasue they are coming from the previous isolates, for example, 5 & 5A, removing then 5A
WM2 <- 
WM %>% filter(
  !Collection_ID == "5A",
  !Collection_ID == "12Ba",
  !Collection_ID == "12Bb",
  !Collection_ID == "13Bb",
  !Collection_ID == "13Ba",
  !Collection_ID == "13Bb",
  !Collection_ID == "13Bc",
  !Collection_ID == "13E",
  !Collection_ID == "13Ea",
  !Collection_ID == "13Eb",
  !Collection_ID == "13Ec",
  !Collection_ID == "15a",
  !Collection_ID == "15b",
  !Collection_ID == "15c",
  !Collection_ID == "19a",
  !Collection_ID == "19b",
  !Collection_ID == "19c",
  !Collection_ID == "74",
  !Collection_ID == "74-SS-2",
  # removed this one becuase the one used was 74-SS1
  !Collection_ID == "74a",
  !Collection_ID == "74b",
  !Collection_ID == "74c",
  !Collection_ID == "136a",
  !Collection_ID == "136b",
  !Collection_ID == "136c",
  !Collection_ID == "143a",
  !Collection_ID == "143b",
  !Collection_ID == "143c",
  !Collection_ID == "143d",
  !Collection_ID == "143e",
  !Collection_ID == "143f",
  !Collection_ID == "147b",
  !Collection_ID == "147c",
  !Collection_ID == "152a",
  !Collection_ID == "152b",
  !Collection_ID == "152c",
  !Collection_ID == "152d",
  !Collection_ID == "152e",
  !Collection_ID == "152f",
  !Collection_ID == "152g",
  !Collection_ID == "152h",
  !Collection_ID == "152i",
  !Collection_ID == "152j",
  !Collection_ID == "152JR",
  !Collection_ID == "160a",
  !Collection_ID == "160b",
  !Collection_ID == "160c",
  !Collection_ID == "161a",
  !Collection_ID == "161b",
  !Collection_ID == "161c",
  !Collection_ID == "167a",
  !Collection_ID == "167b",
  !Collection_ID == "167c",
  !Collection_ID == "184a",
  !Collection_ID == "184b",
  !Collection_ID == "184c",
  !Collection_ID == "202a",
  !Collection_ID == "202b",
  !Collection_ID == "202c",
  !Collection_ID == "232B",
  !Collection_ID == "245a",
  !Collection_ID == "245b",
  !Collection_ID == "245c",
  !Collection_ID == "247a",
  !Collection_ID == "247b",
  !Collection_ID == "247c",
  !Collection_ID == "248a",
  !Collection_ID == "248b",
  !Collection_ID == "262a",## Any of these one because they are S trifoliorum
  !Collection_ID == "262b",
  !Collection_ID == "264a",
  !Collection_ID == "264b",
  !Collection_ID == "136c",
  !Collection_ID == "264c",
  !Collection_ID == "274a",
  !Collection_ID == "274b",
  !Collection_ID == "334a",
  !Collection_ID == "334b",
  !Collection_ID == "334c",
  !Collection_ID == "336a",
  !Collection_ID == "336b",
  !Collection_ID == "336c",
  !Collection_ID == "339a",
  !Collection_ID == "339b",
  !Collection_ID == "339c",
  !Collection_ID == "339d",
  !Collection_ID == "339e",
  !Collection_ID == "339f",
  !Collection_ID == "341a",
  !Collection_ID == "341b",
  !Collection_ID == "341c",
  !Collection_ID == "324a",
  !Collection_ID == "342a",
  !Collection_ID == "342b",
  !Collection_ID == "342c",
  !Collection_ID == "346a",
  !Collection_ID == "346b",
  !Collection_ID == "346c",
  !Collection_ID == "353b",
  !Collection_ID == "354a",
  !Collection_ID == "354b",
  !Collection_ID == "354c",
  !Collection_ID == "360b",
  !Collection_ID == "360c",
  !Collection_ID == "361b",
  !Collection_ID == "361c",
  !Collection_ID == "362b",
  !Collection_ID == "362c",
  !Collection_ID == "363b",
  !Collection_ID == "363c",
  !Collection_ID == "364b",
  !Collection_ID == "364c",
  !Collection_ID == "365b",
  !Collection_ID == "365c",
  !Collection_ID == "366b",
  !Collection_ID == "366c",
  !Collection_ID == "367b",
  !Collection_ID == "367c",
  !Collection_ID == "368b",
  !Collection_ID == "368c",
  !Collection_ID == "369b",
  !Collection_ID == "369c",
  !Collection_ID == "370b",
  !Collection_ID == "370c",
  !Collection_ID == "371b",
  !Collection_ID == "371c",
  !Collection_ID == "372b",
  !Collection_ID == "372c",
  !Collection_ID == "373b",
  !Collection_ID == "373c",
  !Collection_ID == "374b",
  !Collection_ID == "374c",
  !Collection_ID == "375a",
  !Collection_ID == "375b",
  !Collection_ID == "376b",
  !Collection_ID == "376c",
  !Collection_ID == "377b",
  !Collection_ID == "377c",
  !Collection_ID == "400a",
  !Collection_ID == "400b",
  !Collection_ID == "973A",
  !Collection_ID == "973B",
  !Collection_ID == "973C",
  !Collection_ID == "973D",
  !Collection_ID == "973E",
  !Collection_ID == "974A",
  !Collection_ID == "974B",
  !Collection_ID == "974C",
  !Collection_ID == "974D",
  !Collection_ID == "974E",
  !Collection_ID == "975A",
  !Collection_ID == "975B",
  !Collection_ID == "975C",
  !Collection_ID == "975D",
  !Collection_ID == "975E",
  !Collection_ID == "976A",
  !Collection_ID == "976B",
  !Collection_ID == "976C",
  !Collection_ID == "976D",
  !Collection_ID == "976E",
  !Collection_ID == "977A",
  !Collection_ID == "977B",
  !Collection_ID == "977C",
  !Collection_ID == "977D",
  !Collection_ID == "977E",
  !Collection_ID == "978A",
  !Collection_ID == "978B",
  !Collection_ID == "978C",
  !Collection_ID == "978D",
  !Collection_ID == "978E",
  !Collection_ID == "979A",
  !Collection_ID == "979B",
  !Collection_ID == "979C",
  !Collection_ID == "979D",
  !Collection_ID == "979E",
  !Collection_ID == "1048",
  !Collection_ID == "1049",
  !Collection_ID == "1227",
  !Collection_ID == "1228",
  !Collection_ID == "2217",
  !Collection_ID == "2219",
  !Collection_ID == "2225",
  !Collection_ID == "2226",
  !Collection_ID == "2230",
  !Collection_ID == "2245",
  !Collection_ID == "2307",
  !Collection_ID == "2320",
  !Collection_ID == "2325",
  !Collection_ID == "2327",
  !Collection_ID == "2329",
  !Collection_ID == "2352",
  !Collection_ID == "2366",
  !Collection_ID == "2367",
  !Collection_ID == "2369",
  !Collection_ID == "2373",
  !Collection_ID == "2375",
  !Collection_ID == "2380",
  !Collection_ID == "2387",
  !Collection_ID == "2389",
  !Collection_ID == "2392",
  !Collection_ID == "973D"
  ) %>% 
  rename(ID= Collection_ID)
  # Changing the names because they were not 12, it goes directly to 12B, s this 12B is gonna be the 12 now
WM2$ID[ WM2$ID =="12B"]  <- "12"
WM2$ID[ WM2$ID =="13B"]  <- "13"
 #Although 74SS1 belong to # 74 the that I used was specifically this, 74SS1
WM2$ID[ WM2$ID =="74-SS-1"]  <- "74"
WM2$ID[ WM2$ID =="125 SS-4"]  <- "125"
WM2$ID[ WM2$ID =="232A"]  <- "232"
WM2$ID[ WM2$ID =="359b"]  <- "359"
WM2$ID[ WM2$ID =="360a"]  <- "360"
WM2$ID[ WM2$ID =="361a"]  <- "361"
WM2$ID[ WM2$ID =="362a"]  <- "362"
WM2$ID[ WM2$ID =="363a"]  <- "363"
WM2$ID[ WM2$ID =="364a"]  <- "364"
WM2$ID[ WM2$ID =="365a"]  <- "365"
WM2$ID[ WM2$ID =="366a"]  <- "366"
WM2$ID[ WM2$ID =="367a"]  <- "367"
WM2$ID[ WM2$ID =="368a"]  <- "368"
WM2$ID[ WM2$ID =="369a"]  <- "369"
WM2$ID[ WM2$ID =="370a"]  <- "370"
WM2$ID[ WM2$ID =="371a"]  <- "371"
WM2$ID[ WM2$ID =="372a"]  <- "372"
WM2$ID[ WM2$ID =="373a"]  <- "373"
WM2$ID[ WM2$ID =="374a"]  <- "374"
WM2$ID[ WM2$ID =="375c"]  <- "375"
WM2$ID[ WM2$ID =="376a"]  <- "376"
WM2$ID[ WM2$ID =="377a"]  <- "377"

WM3 <- WM2 %>% mutate(ID = as.numeric(ID))
```

##  Setting the groups of isolates
```{r}
#replacing with the original ID, fr example, instead of 12b, now 12
baseline_isolates <- c(1, 8, 12, 20, 21, 74, 87, 118, 123, 129, 449, 461, 467, 475, 558, 564, 568, 581, 645, 667, 800)

survey_isolates <-  c( 2385, 2386, 2098, 2099, 2100, 2139, 2140, 2143, 2220, 2222, 2223, 2320, 2362, 2388, 2390 )

Farmer_fields <- c(136:442, 455, 456, 466, 468, 470, 471, 478:554, 602:610, 612:635, 671, 672, 682:690, 695:797, 810:823, 834, 835, 848:1024, 1255: 1326, 1491: 1500, 1661:1670, 1831: 2246, 2303: 2342,2362: 2381, 2393: 2573)

baseline_isolates_2 <- c(1: 136, 444: 454, 457: 465, 467, 469, 472:477, 555:601, 611, 636:670, 673: 680, 691:694 , 798: 809,  824: 833, 836: 847)

drybean <- c(1, 5, 12,13:118, 123:128, 133:135, 145, 146, 152, 155:160, 182: 185, 194:200, 205, 220, 223, 248, 253:255, 274, 279, 280, 290, 294, 304: 309, 323, 358, 393, 395, 396, 397, 400:402, 405, 408, 409, 434, 443:465, 467, 469: 493, 495:505, 555:613, 615: 760, 762: 819, 824:833, 835:855, 858:921, 966: 971, 980, 981, 985: 996, 998: 1009, 1220:1225 , 1857: 1940, 2242: 2569)

soybean <- c(143, 147, 181, 187, 188, 189,202, 257: 259, 264:268, 276, 281, 289, 293, 295, 310 , 399, 412:417, 419, 425:427, 439, 440, 494, 506:554, 834, 972:979, 982, 997, 1010: 1022, 1025:1219, 1229: 1856, 1941: 2241 )


#Fungicides single mode of action
Group_one <- c("thiophanate_methyl")
Group_3 <- c( "prothioconazole", "tetraconazole", "flutriafol", "propiconazole", "tebuconazole", "difenoconazole")
Group_7 <- c("fluxapyroxad", "boscalid")
Group_11 <- c("picoxystrobin", "azoxystrobin", "fluoxastrobin", "pyraclostrobin", "trifloxystrobin")

not_considered <- c("potassium phosphite")

#Mixxes of fungicides IN COMERCIAL PRODUCTS

 Group_3_Group_11 <-  c(
   "flutriafol + fluoxastrobin",
   "tetraconazole + pyraclostrobin", #there 2 fungicides: single MOA(tetraconazole) + single MOA( pyraclostrobin) #Put attention for the mixxes analyses with 2 single MOA!!
   "propiconazole + azoxystrobin",
"prothioconazole + trifloxystrobin", 
"tetraconazole + fluatriafol + fluxastrobin", #there 2 fungicides: single MOA(tetraconazole) + mix( flutriafol + fluxastrobin) #Put attention for the mixxes mixxes analyses with 2 single MOA!!
"difenoconazole + azoxystrobin")
 
Group_7_Group_11 <- c(
  "fluxapyroxad + pyraclostrobin", 
  "pyraclostrobin + fluxapyroxad + pyraclostrobin")  #there 2 fungicides: single MOA(pyraclostrobin) + mix( fluxapyroxad + pyraclostrobin) #Put attention for the mixxes mixxes analyses with 2 single MOA!!                     
                     
 Group_3_not_considered <- "tebuconazole + potassium phosphite"
 
  unknown <- c("No_info")
 
 
levels(WM3$Fungicide_current_season)[levels(WM3$Fungicide_current_season) == "No_info"] <- "unknown"

levels(WM3$molecule.s._current_season)[levels(WM3$molecule.s._current_season) == ""] <- "unknown"

levels(WM3$Fungicide_previous_seasons)[levels(WM3$Fungicide_previous_seasons) == ""] <- "unknown"


levels(WM3$molecule.s._previous_seasons)[levels(WM3$molecule.s._previous_seasons) == ""] <- "unknown"


 WM3$molecule.s._current_season <- as.character(WM3$molecule.s._current_season)

WM3_ <- WM3%>%
  mutate(
    Group_MOA_current_season = case_when(
       molecule.s._current_season%in% Group_one ~ "Group_one",# filtering and naming "the name of the group" in case of in
       molecule.s._current_season%in% Group_3~ "Group_3",
       molecule.s._current_season%in% Group_7 ~ "Group_7",
       molecule.s._current_season%in% Group_11 ~ "Group_11", molecule.s._current_season%in% Group_3_Group_11~ "Group_3&Group_11",
       molecule.s._current_season%in% Group_7_Group_11~ "Group_7&Group_11",
       molecule.s._current_season%in% Group_3_not_considered~ "Group_3&not_considered",
       molecule.s._current_season%in% unknown~ "unknown", #this consider the control CHECK this out
             TRUE ~ "unknown"# in case of not, naming "not_selected""
    )
  )   
    


```
##  Creating a function for using the outputs of boxplot.stats function and notice the outliers

```{r}
get_range <- function(mynumber) {
  bb <- boxplot.stats(mynumber)
  cc <- bb$stats
  dd <- max(cc)
  ee <- min(cc)
  return(data.frame(upper = dd, lower = ee))
}

```

##  Analysis by fungicide
#  Boscalid
```{r}
#Boscalid fungicide taking the outliers from the 8 observations of each one USING THE FUCTION 
boscalid.filtered  <- boscalid.data %>%
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>% 
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>%
  ungroup() %>%
  select(c(ID, experimental_replicate, repeats, dose, response))

#Boxplot by experimental replicate,  I would need to remove one replicate from 2d experimental replicate for ID= 1032, one replicate from each experimental replicate for ID = 2222 and one repeat from 2nd experimental replicate for ID= 1032
#Boxplot by repeats,   I would need to remove For ID= 1032, the 4th repeat, and For ID= 2222,  the repeat 3,
xx <- EC_table(boscalid.filtered, form = response ~ dose)
boscalid.xx <-
  xx %>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50) %>%
   group_by(ID, EC50) %>%
  mutate(group = ifelse(
    ID %in% baseline_isolates,
    "baseline",
    ifelse(
      ID %in% survey_isolates,
      "survey_isolates",
      "treatmentyear2016_isolates"
      ))) %>% ungroup() %>% 
     mutate(fungicide = "Boscalid") %>% 
  mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group)) %>% 
  ungroup()

```

##  Procedure to get the Discrimantory Concentration (DC)  

#  Boscalid 
```{r}
##Getting relative growth column at each dose where RG = Relative Growth, eg. RG0.025 = Relative Growth at 0.025 ppm##
RG <-
  boscalid.filtered %>% group_by(ID, dose) %>% summarise(mean_response = mean(response, na.rm = TRUE)) %>%
  spread(dose, mean_response) %>%
  mutate(RG0.025 = ((`0.025` / `0`) * 100)) %>%    
     mutate(RG0.05 = ((`0.05` / `0`) * 100)) %>%
        mutate(RG0.05 = ((`0.05` / `0`) * 100)) %>%  
          mutate(RG0.1 = ((`0.1` / `0`) * 100)) %>%
            mutate(RG0.2 = ((`0.2` / `0`) * 100)) %>%
              mutate(RG0.8 = ((`0.8` / `0`) * 100)) %>% 
  ungroup()
#Since here EC50 is known as Estimate EC50 from EC50 table and normalizing data
final.boscalid <-#joining
  left_join (RG, boscalid.xx) %>% # normalizing data
  mutate(logEC50 = (log(EC50))) %>% 
rename(Estimate.50 = EC50)

####################################################################################
###Dose chosen as DC. Although there is one dose with higher r2, there is no difference between and this was selected
# Linear model of log EC50 and relative growth at 0.2 ppm, check normality and homogeneity of variances
finalRG0.2 <- lm(logEC50 ~ RG0.2, final.boscalid)
summary(finalRG0.2)
plot(finalRG0.2)

##taking out outliers from Q-Q PLOT $ LEVERAGE TEST, ISOLATES # 1032 from treatment, 2222 & 2223 from Farmer fields##
final.boscalid.clean <-
  final.boscalid %>% filter(!ID == "1032", !ID == "2222",!ID == "2223")
 
 finalRG0.2 <- lm(logEC50 ~ RG0.2, final.boscalid.clean)
  summary(finalRG0.2)
  plot(finalRG0.2)
  
# Linear Regression graph of log EC50 and relative growth at 0.2 ppm

  ggplot(finalRG0.2, aes(x = RG0.2, y = logEC50)) +  geom_point() + geom_smooth(method = "lm") +  theme(
    plot.title = element_text(
    size = 12,
    face = "bold",
    hjust = 0.5,
    family = "Verdana"
    ),
    axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
    axis.text = element_text(
    face = "bold",
    size = 14,
    family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
    ) + labs(title = "Linear regression between EC50 values & relative growth of Boscalid at 0.2 ppm", x =
    "Relative growth (%)", y = "Log EC50")
    

# Getting the EC50DC according to the model
final.boscalid.DC <-
  final.boscalid.clean %>% mutate(Estimate.50DC = exp((finalRG0.2[[1]][[1]]) + ((finalRG0.2[[1]][[2]]) * RG0.2))) %>%# here I need to do this dynamic
  select(ID, Estimate.50DC, Estimate.50)


# Linear model of EC50  and EC50DC just to corroborate is a GOOD RELATIONSHIP, check normality and homogeneity of variances
final.boscalid.DC.0.2 <- lm (Estimate.50DC ~ Estimate.50, final.boscalid.DC ) 
summary(final.boscalid.DC.0.2)
plot(final.boscalid.DC.0.2)



#pdf("Linear regression of boscalid 0.2 ppm.pdf")  
ggplot(final.boscalid.DC.0.2, aes(x = Estimate.50, y = Estimate.50DC)) +  theme(
  plot.title = element_text(
  size = 14,
  face = "bold",
  hjust = 1,
  family = "Verdana"
  ),
  axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
  axis.text = element_text(
  face = "bold",
  size = 14,
  family = "Verdana"
  ),
  panel.background = element_rect(fill = "white", colour = "grey50")
  ) + labs(title = "Linear regression between EC50 and EC50(D) values of Boscalid ", x =
  "EC50 (ppm)", y = "EC50(D) (ppm)") + geom_point(shape = 24) + geom_smooth(method = "lm")
  

```
##  Boscalid with survey (pre-test Fungicide) inlcuding Farmer fields and Fungicide field trials
```{r}
boscalid_data <- survey.data.3 %>%
  select(ID,
         repeats,
         experimental_replicate,
         boscalid.growth,
         control.growth) %>%
  rename(response = boscalid.growth, control = control.growth) 

# Using the previous  function in order to take out the outliers
boscalid.filtered.survey <- boscalid_data %>%
  group_by(ID) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  mutate(control_range = list(get_range(control))) %>%
  unnest() %>%
  filter(response <= upper &
           response >= lower,
         control <= upper1 & control >= lower1) %>%
  ungroup() %>%
  select(c(ID, experimental_replicate, repeats, response, control))

#  Becasue of that taking outliers by and then
boscalid.filtered. <- boscalid.filtered.survey %>%
  group_by(ID) %>%
  summarise(
  mean_response = mean(response, na.rm = TRUE),
  mean_control = mean(control, na.rm = TRUE)
  ) %>%
  mutate(RG = (mean_response / mean_control) * 100) %>%
  mutate(Estimate.50DC = exp (finalRG0.2[[1]][[1]] + finalRG0.2[[1]][[2]] * RG)) %>% ungroup() %>% 
  rename(EC50DC= Estimate.50DC) %>% 
  mutate(ID = as.numeric(ID)) %>% 
   select(c(ID, EC50DC)) 

```
##  Analysis by fungicide
#  Picoxystrobin
```{r}
#Picoxystrobin  fungicide taking the outlayers from the 8 observations of each one USING THE FUCTION
picoxystrobin.filtered <- picoxystrobin.data %>%
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>%
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, repeats, dose, response))


# Getting EC50 by EC_table #
yy <- EC_table(picoxystrobin.filtered, form = response ~ dose)

picoxystrobin.yy <-
  yy %>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50)%>%
   group_by(ID, EC50) %>% 
  mutate(group = ifelse(
  ID %in% baseline_isolates,
  "baseline",
  ifelse(
  ID %in% survey_isolates,
  "survey_isolates",
  "treatmentyear2016_isolates"
  )
  )) %>% ungroup() %>%
  mutate(fungicide = "Picoxystrobin") %>%   mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>%
  mutate(group = as.factor(group))%>% 
  ungroup()

```
##  Procedure to get the Discriminatory Concentration (DC) 
#  Picoxystrobin
```{r}
#Getting relative growth column at each dose where RG= Relative Growth, eg. RG0.01= Relative Growth at 0.01 ppm
RG <-
  picoxystrobin.filtered %>% group_by(ID, dose) %>% summarise(mean_response = mean(response, na.rm = TRUE)) %>% spread(dose, mean_response) %>%
  mutate(RG0.01 = ((`0.01` / `0`) * 100)) %>%
    mutate(RG0.02 = ((`0.02` / `0`) * 100)) %>%  
      mutate(RG0.04 = ((`0.04` / `0`) * 100)) %>%
        mutate(RG0.06 = ((`0.06` / `0`) * 100)) %>%
          mutate(RG0.1 = ((`0.1` / `0`) * 100))
  #Since here EC50 is known as Estimate EC50 from EC50 table and normalizing data

final.picoxystrobin <- #joining table
  left_join (RG, picoxystrobin.yy) %>%
  mutate(logEC50 = (log(EC50))) %>% # normalizing data
  rename(Estimate.50 = EC50)

##################################################################################
#Dose chosen as DC
# Linear model of log EC50 and relative growth at 0.01 ppm, check normality and homogeneity of variances
#pdf("picoxystrobin_assumptions_linearmodel_dosechoseasDC_with_outlayers.pdf")
finalRG0.01 <- lm(logEC50 ~ RG0.01, final.picoxystrobin)
summary(finalRG0.01)
plot(finalRG0.01)
#check_assumptions(finalRG0.01)
#dev.off()
##taking out outlayers from Q-Q PLOT $ LEVERAGE TEST, ISOLATES # 1032 from treatment, 558 & 581 from baseline##
#pdf("picoxystrobin_assumptions_linearmodel_dosechoseasDC.pdf")
final.picoxystrobin.clean <- final.picoxystrobin %>% filter( !ID == "1032",!ID == "558", !ID == "581" ) 
finalRG0.01 <- lm(logEC50 ~ RG0.01, final.picoxystrobin.clean)
summary(finalRG0.01)
plot(finalRG0.01)

# Getting the EC50DC according to the model
final.picoxystrobin.DC <-
  final.picoxystrobin.clean %>% 
  mutate(Estimate.50DC = exp(finalRG0.01[[1]][[1]] + finalRG0.01[[1]][[2]] *
  RG0.01)) %>% # here I need to do this dynamic
  select(ID, Estimate.50DC, Estimate.50)
  
# Linear model of EC50  and EC50DC just to corroborate is a GOOD RELATIONSHIP, check normality and homogeneity of variances
final.picoxystrobin.DC.0.01 <- lm (Estimate.50DC ~ Estimate.50, final.picoxystrobin.DC)
summary(final.picoxystrobin.DC.0.01 )
plot(final.picoxystrobin.DC.0.01)
#check_assumptions(final_picoxystrobin_DC_0.01 )
#pdf("Linear regression of picoxystrobin 0.01 ppm.pdf")  
# Linear Regression graph of EC50 and EC50DC
ggplot(final.picoxystrobin.DC.0.01,
       aes(x = Estimate.50, y = Estimate.50DC)) +  theme(
       plot.title = element_text(
       size = 14,
       face = "bold",
       hjust = 1,
       family = "Verdana"
       ),
       axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
       axis.text = element_text(
       face = "bold",
       size = 14,
       family = "Verdana"
       ),
       panel.background = element_rect(fill = "white", colour = "grey50")
       ) + labs(title = "Linear regression between EC50 and EC50(D) values of Picoxystrobin ", x =
       "EC50 (ppm)", y = "EC50(D) (ppm)") + geom_point() + geom_smooth(method = "lm")
       
#dev.off()

```
#  Picoxystrobin With Survey(Pre-Test Fungicide) include Farmer fields and Fungicide field trials
```{r}
picoxystrobin_data <- survey.data.3 %>%
  select(
  ID,
  repeats,
  experimental_replicate,
  picoxystrobin.growth,
  sham.growth,
  control.growth
  ) %>%
  rename(response = picoxystrobin.growth, control = sham.growth) %>% select(-control.growth) 

# Using the function in order to take out the outliers
picoxystrobin.filtered.survey <- picoxystrobin_data %>%
group_by(ID) %>%
mutate(response_range = list(get_range(response))) %>%
unnest() %>%
mutate(control_range = list(get_range(control))) %>%
unnest() %>%
filter(response <= upper &
response >= lower,
control <= upper1 & control >= lower1) %>%
ungroup() %>%
select(c(ID, experimental_replicate, repeats, response, control))
  
#  Becasue of that taking outlayers by and then
picoxystrobin.filtered. <- picoxystrobin.filtered.survey %>%
  group_by(ID) %>%
    summarise(
      mean_response = mean(response, na.rm = TRUE),
      mean_control = mean(control, na.rm = TRUE)
       ) %>%
         mutate(RG = (mean_response / mean_control) * 100) %>%
           mutate(Estimate.50DC = exp (finalRG0.01[[1]][[1]] + finalRG0.01[[1]][[2]] * RG)) %>%
  ungroup() %>%
  rename(EC50DC= Estimate.50DC) %>% 
  mutate(ID = as.numeric(ID)) %>% 
   select(c(ID, EC50DC)) 
             

```
##  Analysis by fungicide
#  Tetraconazole
```{r}
#Tetraconzaole  fungicide taking the outlayers from the 8 observations of each one USING THE FUCTION

tetraconazole.filtered <- tetraconazole.data %>%
  rename(response = growth) %>%
  group_by(ID, dose) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  filter(response <= upper & response >= lower) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, repeats, dose, response))

bb<- EC_table(tetraconazole.filtered, form = response ~ dose)

tetraconazole.bb <-
  bb %>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50)%>%
  group_by(ID, EC50) %>% 
  mutate(group = ifelse(
    ID %in% baseline_isolates,
    "baseline",
    ifelse(
    ID %in% survey_isolates,
    "survey_isolates",
    "treatmentyear2016_isolates"
    )
    )) %>% ungroup() %>% 
  mutate(fungicide = "Tetraconazole") %>% mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% 
  mutate(group = as.factor(group)) %>% 
  ungroup()
```
##  Procedure to get the Discrimanatory Concentration (DC) 
#  Tetraconazole
```{r}
RG <-
  tetraconazole.filtered %>% 
   group_by(ID, dose) %>%
    summarise(mean_response = mean(response, na.rm = TRUE)) %>% 
     spread(dose, mean_response) %>%
      mutate(RG0.5 =((`0.5` / `0`) * 100)) %>% mutate(RG1 = ((`1` / `0`) * 100)) %>%       mutate(RG2 =((`2` / `0`) * 100)) %>% 
  mutate(RG3 = ((`3` / `0`) * 100)) %>% 
  mutate(RG5 =((`5` / `0`) * 100)) 

#Since here EC50 is known as Estimate EC50 from EC50 table and normalizing data


final.tetraconazole <-#joining
  left_join (RG, tetraconazole.bb) %>% # normalizing data
  mutate(logEC50 = (log(EC50))) %>% 
  rename(Estimate.50 = EC50)
#pdf("tetraconazole_assumptions_linearmodel_each_dose&Linear_regression_with_best_model.pdf")



################################################################################
#Dose chosen as DC
# Linear model of log EC50 and relative growth at 2 ppm, check normality and homogeneity of variances
#pdf("tetraconazole_assumptions_linearmodel_dosechoseasDC_with_outlayers.pdf")
finalRG2 <- lm(logEC50 ~ RG2, final.tetraconazole)
summary(finalRG2)
plot(finalRG2)
#check_assumptions(finalRG2)
#dev.off()
##taking out outlayers from Q-Q PLOT & LEVERAGE TEST, ISOLATES #  21 , 558 & 667 from baseline##
#pdf("tetraconazole_assumptions_linearmodel_dosechoseasDC.pdf")
final.tetraconazole.clean <- final.tetraconazole %>% filter( !ID == "21",!ID == "558", !ID == "667" ) 
finalRG2 <- lm(logEC50 ~ RG2, final.tetraconazole.clean)
summary(finalRG2)
plot(finalRG2)
#check_assumptions(finalRG2)
#dev.off()
# Linear Regression graph of log EC50 and relative growth at 2 ppm
ggplot(finalRG2, aes(x = RG2, y =  logEC50)) +  theme(plot.title = element_text(size = 16, face = "bold", hjust = 1))  + labs(title = "Linear regression of tetraconazole 2 ppm", x =
                                                                                                                                "Relative growth(%)", y = "logEC50") + theme (axis.title.x = element_text(size = 12, face = "bold", hjust = 0.5)) + theme(axis.title.y = element_text(size = 12, face = "bold", hjust = 0.5)) +
                                                                                                                                theme(axis.text.x = element_text(size = 12)) + theme(axis.text.y = element_text(size = 12)) + theme (axis.line = element_line(colour = "grey50", size = 1)) +
                                                                                                                                geom_point() + geom_smooth(method = "lm")
                                                                              # Getting the EC50DC according to the model
final.tetraconazole.DC <- final.tetraconazole.clean %>% mutate(Estimate.50DC = exp(finalRG2[[1]][[1]] + finalRG2[[1]][[2]]*RG2)) %>% # here I need to do this dynamic
  select(ID, Estimate.50DC, Estimate.50)
# Linear model of EC50  and EC50DC just to corroborate is a GOOD RELATIONSHIP, check normality and homogeneity of variances
final.tetraconazole.DC.2 <- lm (Estimate.50DC ~ Estimate.50, final.tetraconazole.DC)
summary(final.tetraconazole.DC.2)
plot(final.tetraconazole.DC.2)
#check_assumptions(final_tetraconazole_DC_2)
#pdf("Linear regression of tetraconazole 2 ppm.pdf")   
# Linear Regression graph of EC50 and EC50DC
ggplot(final.tetraconazole.DC.2,
       aes(x = Estimate.50, y = Estimate.50DC)) +  theme(
         plot.title = element_text(
        size = 14, 
        face = "bold", 
        hjust = 1,
        family = "Verdana"
        ),
        axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
        axis.text = element_text(
          face = "bold",
          size= 14,
          family= "Verdana"
          ),
        panel.background = element_rect(fill = "white",colour = "grey50")) + labs(title= "Linear regression between EC50 and EC50(D) values of Tetraconazole", x =
       "EC50 (ppm)", y = "EC50(D) (ppm)") + geom_point(shape=21) + geom_smooth(method = "lm")
        
       



```
#  Tetraconazole With Survey(Pre-Test Fungicide) included Farmer fields and Fungicide field trials
```{r}
tetraconazole_data <- survey.data.3 %>%
  select(ID,
  repeats,
  experimental_replicate,
  tetraconazole.growth,
  control.growth) %>%
  rename(response = tetraconazole.growth, control = control.growth) 
 
# Using the function in order to take out the outliers#

tetraconazole.filtered.survey <- tetraconazole_data %>%
  group_by(ID) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  mutate(control_range = list(get_range(control))) %>%
  unnest() %>%
  filter(response <= upper & response >= lower, control <= upper1 & control >= lower1) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, repeats, response, control))

#  Becasue of that taking outlayers by and then
tetraconazole.filtered. <- tetraconazole.filtered.survey %>%
  group_by(ID) %>% 
  summarise(mean_response =mean(response, na.rm = TRUE), mean_control =mean(control, na.rm = TRUE)) %>% 
  mutate(RG= (mean_response/mean_control)*100) %>% 
  mutate(Estimate.50DC = exp (finalRG2[[1]][[1]] + finalRG2[[1]][[2]]*RG)) %>% 
ungroup() %>% 
  rename(EC50DC= Estimate.50DC) %>% 
  mutate(ID = as.numeric(ID)) %>% 
   select(c(ID, EC50DC))



```
##  Analysis by fungicide
#  Thiophanate methyl
```{r}
#function of taking outliers
TM.filtered <- TMdata %>%
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>%
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>% 
  ungroup() %>% 
  select(c(ID, experimental_replicate, repeats, dose, response))%>%
  group_by (ID, dose, repeats, response) %>%
  filter(experimental_replicate==2 | experimental_replicate==3) ## Discarding all experimental replicate 1 due not consistence in results## anyways it was not consistence in those ones

zz <- EC_table(TM.filtered, form = response ~ dose)
 RG <- TM.filtered %>% group_by(ID,dose) %>% summarise(mean_response=mean(response,na.rm=TRUE)) %>% spread(dose,mean_response) %>%  mutate(RG0.75=((`0.75`/`0`)*100)) %>% mutate(RG1=((`1`/`0`)*100)) %>% mutate(RG1.5=((`1.5`/`0`)*100)) %>% mutate(RG2=((`2`/`0`)*100)) %>% mutate(RG2.5=((`2.5`/`0`)*100)) %>%  mutate(RG10=((`10`/`0`)*100))
# 
#Since here EC50 is known as Estimate EC50 from EC50 table 
 
# #Ordering the table

TM.zz <-   zz%>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50)%>%
  group_by(ID, EC50) %>% mutate(group = ifelse(
    ID %in% baseline_isolates,
    "baseline",
    ifelse(
    ID %in% survey_isolates,
    "survey_isolates",
    "treatmentyear2016_isolates"
    )
    )) %>% ungroup() %>% mutate(fungicide = "TM") %>% mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group)) %>% 
  ungroup()
  
#Since here EC50 is known as Estimate EC50 from EC50 table and normalizing data

 final.TM<-#joining
   left_join (RG, TM.zz) %>% #normalizing data
   mutate(logEC50=(log(EC50))) %>% 
   rename(Estimate.50 = EC50)

 
 
#Dose chosen as DD the highest concentration
# Linear model of log EC50 and relative growth at 10 ppm, check normality and homogeneity of variances
finalRG10<- lm(logEC50~RG10,final.TM) 
summary(finalRG10)
plot(finalRG10)
#check_assumptions(finalRG2.5)
    # Linear Regression graph of log EC50 and relative growth at 10 ppm
ggplot(finalRG10, aes(x = RG10, y = logEC50)) +  geom_point() + geom_smooth()

# Getting the EC50DD according to the model

final.TM.DD <- final.TM %>% mutate(Estimate.50DC = exp(finalRG10[[1]][[1]] - finalRG10[[1]][[2]]*RG10)) %>% # here I need to do this dynamic 
  select(ID, Estimate.50DC, Estimate.50)
# Linear model of EC50  and EC50DD just to corroborate is a GOOD RELATIONSHIP, check normality and homogeneity of variances
final.TM.DD.10 <- lm (Estimate.50DC ~ Estimate.50, final.TM.DD)
summary(final.TM.DD.10)
plot(final.TM.DD.10)
#check_assumptions(final_TM_DD_10)
#pdf("Linear regression of thiophanate methyl 10 ppm.pdf")   
## Linear Regression graph of EC50 and EC50DD
ggplot(final.TM.DD.10, aes(x = Estimate.50, y = Estimate.50DC)) +  theme(plot.title = element_text(size = 16, face = "bold", hjust = 1)) + labs(title = "Linear regression of thiophanate methyl 10 ppm", x ="EC50 (ppm)", y = "EC50DD (ppm)" ) + geom_point() + geom_smooth(method = "lm")



```
#  Thiophanate methyl with Survey(Pre-Test Fungicide)
```{r}
TM_data <- survey.data.3 %>%
  select(ID, repeats, experimental_replicate, TM.growth, control.growth) %>% 
  rename(response = TM.growth, control = control.growth)%>%  
  group_by(ID) %>% 
  summarise(mean_response =mean(response, na.rm = TRUE), mean_control =mean(control, na.rm = TRUE)) %>% 
  mutate(RG= (mean_response/mean_control)*100)  %>% 
mutate(resistance = ifelse(RG >24,#more or equal to 25%, 
                           "resistant", "nonresistant")) 


```
#  Another approach with TM to pick the probably isolates with high EC50 of the model with the best model
```{r}

#Dose chosen as  potential DD

# Linear model of log EC50 and relative growth at 2.5 ppm, check normality and homogeneity of variances

finalRG2.5<- lm(logEC50~RG2.5,final.TM) 
summary(finalRG2.5)
plot(finalRG2.5)
#check_assumptions(finalRG2.5)
      # Linear Regression graph of log EC50 and relative growth at 2.5 ppm
ggplot(finalRG2.5, aes(x = RG2.5, y = logEC50)) +  geom_point() + geom_smooth()


# Getting the EC50DD according to the model
final.TM.DD1 <- final.TM %>% mutate(Estimate.50DC = exp(finalRG2.5[[1]][[1]] + finalRG2.5[[1]][[2]]*RG2.5)) %>% # here I need to do this dynamic
  select(ID, Estimate.50DC, Estimate.50)
# Linear model of EC50  and EC50DD, check normality and homogeneity of variances
final.TM.DD.2.5 <- lm (Estimate.50DC ~ Estimate.50, final.TM.DD1)
summary(final.TM.DD.2.5)
plot(final.TM.DD.2.5)
#check_assumptions(final_TM_DD_2.5)
#pdf("Linear regression of thiophanate methyl 10 ppm.pdf")   
## Linear Regression graph of EC50 and EC50DD
ggplot(final.TM.DD.2.5, aes(x = Estimate.50, y = Estimate.50DC)) +  theme(plot.title = element_text(size = 16, face = "bold", hjust = 1)) + labs(title = "Linear regression of thiophanate methyl 10 ppm", x ="EC50 (ppm)", y = "EC50DD (ppm)" ) + geom_point() + geom_smooth(method = "lm")

#dev.off()

#TM WITH SURVEY(PRE-TEST FUNGICIDE)
#  I cannot use the model because the DC used was 10 ppm, and the model was built based on 2.5 ppm


TM.data <- survey.data.3 %>%
  select(ID, repeats, experimental_replicate, TM.growth, control.growth) %>% 
  rename(response = TM.growth, control = control.growth) %>% 
 # Using the function in order to take out the outliers#
  group_by(ID) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  mutate(control_range = list(get_range(control))) %>%
  unnest() %>%
  filter(response <= upper & response >= lower, control <= upper1 & control >= lower1) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, response, control)) %>% 
  group_by(ID) %>% 
  summarise(mean_response =mean(response, na.rm = TRUE), mean_control =mean(control, na.rm = TRUE)) %>% 
  mutate(RG= (mean_response/mean_control)*100) %>% 
ungroup() %>%
    mutate(ID = as.numeric(ID)) %>%
   select(c(ID, RG)) %>% 
  arrange(RG) %>% 
  filter(RG >20) %>% # More than 20 % arbitrarily selected
select(ID)

  

```
##  Ordering for each fungicide
```{r}

#Selecting the EC50D from the serial dilution
boscalid.complete <- final.boscalid.DC %>% 
 ####WATCH OUT, Based on EC50DC
   rename(EC50DC = Estimate.50DC) %>% 
  select(ID, EC50DC) %>% 
  bind_rows(boscalid.filtered.) %>% 
ungroup() %>%  
  mutate( ID= as.numeric(ID)) %>% 
  group_by(ID) %>%
  top_n(1, EC50DC) %>%
  ungroup() %>% 
    mutate(Origin = ifelse(
    ID %in% baseline_isolates_2,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host)) %>% 
#taking out "different host" becuse does not belong to drybean nor soybean
  filter(!ID == 8,!ID == 129 )
 #####PICOXYSTROBIN##

#Selecting the EC50D from the serial dilution
picoxystrobin.complete <- final.picoxystrobin.DC %>% 
  ####WATCH OUT, Based on EC50DC
   rename(EC50DC = Estimate.50DC) %>% 
  select(ID, EC50DC) %>%
  bind_rows(picoxystrobin.filtered.) %>% 
  ungroup() %>%
  mutate( ID= as.numeric(ID)) %>% 
  group_by(ID) %>%
  top_n(1, EC50DC) %>%
  ungroup() %>% 
  mutate(Origin = ifelse(
    ID %in% baseline_isolates_2,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host)) %>%
  #taking out "different host" becuse does not belong to drybean nor soybean
  filter(!ID == 8,!ID == 129 )
  

#######TETRACONAZOLE##
 
 #Selecting the EC50D from the serial dilution
tetraconazole.complete <- final.tetraconazole.DC %>% 
   ####WATCH OUT, Based on EC50DC
  rename(EC50DC = Estimate.50DC) %>% 
  select(ID, EC50DC) %>% ungroup() %>% 
bind_rows(tetraconazole.filtered.) %>% 
  ungroup() %>%
  mutate( ID= as.numeric(ID)) %>% 
  group_by(ID) %>%
  top_n(1, EC50DC) %>%
  ungroup() %>% 
   mutate(Origin = ifelse(
    ID %in% baseline_isolates_2,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host)) %>% #taking out "different host" becuse does not belong to drybean nor soybean
  filter(!ID == 8,!ID == 129 )
# that is the diffrenece
####WATCH OUT, Based on EC50DC

##TM#######
    #Selecting the EC50D from the serial dilution
TM.complete<- final.TM.DD1 %>% 
   ####WATCH OUT, Based on EC50DC
  rename(EC50DC = Estimate.50DC) %>% 
  select(ID, EC50DC) %>% 
  ungroup() %>% 
mutate( ID= as.numeric(ID)) %>% 
    mutate(Origin = ifelse(
    ID %in% baseline_isolates_2,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host)) %>% #taking out "different host" becuse does not belong to drybean nor soybean
  filter(!ID == 8,!ID == 129 )


```
# ANOVA
```{r}
###########Boscalid

##NORMALITY TEST-Shapiro_test

shapiro.test.boscal <- boscalid.complete %>%
  group_by(Origin) %>%
  do(tidy(shapiro.test(.$EC50DC)))
shapiro.test.boscal 
# No normals
shapiro.test.boscal.2 <- boscalid.complete%>%
  group_by(Host) %>%
  do(tidy(shapiro.test(.$EC50DC)))
shapiro.test.boscal.2

 #NO NORMALILTY thats is why  krusKal
#by origin

kruskal.test(EC50DC ~ Origin, data = boscalid.complete)

#There is difference p-value = 1.25 *10 -05

DunnTest(EC50DC ~ Origin, data = boscalid.complete, method = "bonferroni")
#P VALUE 0.00057 *** FF-Baseline
#P VALUE 0.00093 *** FFT-FF


#by hosts

kruskal.test(EC50DC ~ Host, data = boscalid.complete)
#There is NO difference p-value 0.06043



####### pico


##NORMALITY TEST-Shapiro_test

shapiro.test.pico <-picoxystrobin.complete %>%
  group_by(Origin) %>%
  do(tidy(shapiro.test(.$EC50DC)))
shapiro.test.pico 
  ##NO normals
shapiro.test.pico.2 <-picoxystrobin.complete %>%
  group_by(Host) %>%
  do(tidy(shapiro.test(.$EC50DC)))
shapiro.test.pico.2

 #NO NORMALILTY thats is why  krusKal
#by origin

kruskal.test(EC50DC ~ Origin, data = picoxystrobin.complete)

#There is NO difference p-value = 0.3702


#by hosts

kruskal.test(EC50DC ~ Host, data = picoxystrobin.complete)
#There is NO difference p-value 0.6842






#########tetra
 

##NORMALITY TEST-Shapiro_test

shapiro.test.tetra <- tetraconazole.complete %>%
  group_by(Origin) %>%
  do(tidy(shapiro.test(.$EC50DC)))
shapiro.test.tetra 
# No normals
shapiro.test.tetra.2 <- tetraconazole.complete %>%
  group_by(Host) %>%
  do(tidy(shapiro.test(.$EC50DC)))
shapiro.test.tetra.2

 #NO NORMALILTY thats is why  krusKal
#by origin

kruskal.test(EC50DC ~ Origin, data = tetraconazole.complete)

#There NO difference p-value = 0.05979




#by hosts

kruskal.test(EC50DC ~ Host, data = tetraconazole.complete)
#There is NO difference p-value 0.4241


```

##   Plots
```{r}
plot.bos <- boscalid.complete%>%
  ggplot(aes(x = Origin, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chartreuse2",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Origin", y = "EC50 (ppm)") + theme(
    panel.border = element_rect(colour = "black", fill=NA, size=1),
    axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50" )
  )

plot.bos

plot.pico <- picoxystrobin.complete%>%
  ggplot(aes(x = Origin, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chocolate1",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs(x = "Origin", y = "EC50 (ppm)") + theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.pico


plot.tetra <- tetraconazole.complete%>%
  ggplot(aes(x = Origin, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "deepskyblue",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Origin", y = "EC50 (ppm)") + theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.tetra


# Suppose TM
plot.TM <- TM.complete%>%
  ggplot(aes(x = Origin, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "goldenrod",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Origin", y = "EC50 (ppm)") + theme(
    panel.border = element_rect(colour = "black", fill=NA, size=1),
    axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50" )
  )

plot.TM

```

#  Different grouping plots

```{r}
plot.bos.2 <- boscalid.complete%>%
  ggplot(aes(x = Host, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chartreuse2",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Group", y = "EC50 (ppm)") + theme(
    panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.bos.2

plot.pico.2 <- picoxystrobin.complete%>%
  ggplot(aes(x = Host, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chocolate1",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Group", y = "EC50 (ppm)") + theme(
    panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.pico.2


plot.tetra.2 <- tetraconazole.complete%>%
  ggplot(aes(x = Host, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0.5,
    shape = 21,
    color = "black",
    fill = "deepskyblue",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Group", y = "EC50 (ppm)") + theme(
        panel.border = element_rect(colour = "black", fill=NA, size=1),

        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.tetra.2

# Suppose TM
plot.TM.2 <- TM.complete%>%
  ggplot(aes(x = Host, y = EC50DC)) +
  geom_jitter(
    width = .1,
    height = 0.5,
    shape = 21,
    color = "black",
    fill = "goldenrod",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Group", y = "EC50 (ppm)") + theme(
        panel.border = element_rect(colour = "black", fill=NA, size=1),

        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.TM.2



```


# Using the function to detect outliers considered since the third quantil from the outliers of ecah fungicicde

```{r}
 #New function to detect outliers of EC50DC en each group for fungicide. These ouliers are considered as equal to the third quantil, i.e. the second max stats
                                                              
 get_range2 <- function(myoutlier) {
  alpha <- boxplot.stats(myoutlier)
  necrosis <- alpha$stats
  wilt <- max(necrosis[necrosis!=max(necrosis)])
    return(data.frame(outlier = wilt))
}           
```
etect outliers considered since the third quantil from the outliers of ecah fungicicde

```{r}
#Boscalid
# Using the function to detect outliers

boscalid.complete.2<- boscalid.complete%>% 
group_by(Origin)%>%
mutate(EC50DC_outlier = list(get_range2(EC50DC)))%>%
unnest() %>% 
filter(EC50DC >=  outlier) %>% ungroup() %>% 
  select(ID)
         
summary.field.original <- WM3_ %>% 
  select(Field, ID, Group_MOA_current_season ) %>% #
  unique() %>% 
  group_by(Field, Group_MOA_current_season ) %>% #
  summarize(Num_original_isolates = n()) %>% 
  mutate(Empty_field = (Field == "")) %>% 
  filter(Empty_field == FALSE) %>% 
  select(-Empty_field) %>% 
  ungroup()


mu <- boscalid.complete.2 %>%
  full_join(WM3_, by = "ID") %>%
     select(colnames(boscalid.complete.2), Field,  Year, State, Group_MOA_current_season, Host) %>%
   left_join(summary.field.original)  %>%
   mutate(Group_MOA_current_season = na_if(Group_MOA_current_season, "")) %>%
     arrange(ID) %>% 
      rename(N_iso_perfield =Num_original_isolates, Group= Group_MOA_current_season) %>% 
        mutate(Origin = ifelse(
    ID %in% baseline_isolates_2,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host)) 



  
anyDuplicated(mu$ID)

# Summarizing 1 BY ORIGIN
mu_summary1 <- mu %>% 
  group_by (Origin) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
# creating the table in pdf
# field_ID_data_bos_summary1 %>%
#   kable(format = "markdown") %>%    write2pdf("boscalid_outliers_summary_by_origin.pdf")
# Summarizing 2 by host
mu_summary2 <- mu %>% 
  group_by ( Host) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1))  %>% 
    ungroup() %>% 
              add_row(Host = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
#creating the table in pdf
# field_ID_data_bos_summary2 %>%
#   kable(format = "markdown") %>%    write2pdf("boscalid_outliers_summary_by_hosts.pdf")


# Summarizing 3  BY STATE
mu_summary3 <- mu %>% 
  group_by ( State) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              add_row(State = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))

#creating the table in pdf
# field_ID_data_bos_summary3 %>%
#   kable(format = "markdown") %>%    write2pdf("boscalid_outliers_summary_by_states.pdf")


# Summarizing 4  BY STATE  NE and host soybeans
mu_summary4 <- mu %>% 
  group_by (Origin, Host,State) %>% 
             summarize(N_isol = n()) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              filter(Host=="soybeans"|State == "NE") %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol))


#Picoxystrobin
# Using the function

picoxystrobin.complete.2<- picoxystrobin.complete%>% 
group_by(Origin)%>%
mutate(EC50DC_outlier = list(get_range2(EC50DC)))%>%
unnest() %>% 
filter(EC50DC >=  outlier) %>% ungroup() %>% 
  select(ID)


alpha <- picoxystrobin.complete.2 %>%
  full_join(WM3_, by = "ID") %>%
   select(colnames(picoxystrobin.complete.2), Field,  Year, State, Group_MOA_current_season, Host) %>%
   left_join(summary.field.original)  %>%
   mutate(Group_MOA_current_season = na_if(Group_MOA_current_season, "")) %>%
     arrange(ID) %>% 
   
   rename(N_iso_perfield =Num_original_isolates, Group= Group_MOA_current_season)  %>% 
mutate(Origin = ifelse(
    ID %in% baseline_isolates_2,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host)) 

  
anyDuplicated(alpha$ID)

# Summarizing 1 BY ORIGIN
alpha_summary1 <- alpha %>% 
  group_by (Origin) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
# creating the table in pdf
# field_ID_data_bos_summary1 %>%
#   kable(format = "markdown") %>%    write2pdf("picoxystrobin_outliers_summary_by_origin.pdf")
# Summarizing 2 by host
alpha_summary2 <- alpha %>% 
  group_by ( Host) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1))  %>% 
    ungroup() %>% 
              add_row(Host = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
#creating the table in pdf
# field_ID_data_bos_summary2 %>%
#   kable(format = "markdown") %>%    write2pdf("picoxystrobin_outliers_summary_by_hosts.pdf")


# Summarizing 3  BY STATE
alpha_summary3 <- alpha %>% 
  group_by ( State) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              add_row(State = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))

#creating the table in pdf
# field_ID_data_bos_summary3 %>%
#   kable(format = "markdown") %>%    write2pdf("picoxystrobin_outliers_summary_by_states.pdf")


# Summarizing 4  BY STATE  NE and host soybeans
alpha_summary4 <- alpha %>% 
  group_by (Origin, Host,State) %>% 
             summarize(N_isol = n()) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              filter(Host=="soybeans"|State == "NE") %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol))

#Tetraconazole
# Using the function

tetraconazole.complete.2<- tetraconazole.complete%>% 
group_by(Origin)%>%
mutate(EC50DC_outlier = list(get_range2(EC50DC)))%>%
unnest() %>% 
filter(EC50DC >=  outlier) %>% ungroup() %>% 
  select(ID, EC50DC,Origin, Host)


gamma <- tetraconazole.complete.2 %>%
  full_join(WM3_, by = "ID") %>%
       select(colnames(tetraconazole.complete.2), Field,  Year, State, Group_MOA_current_season, Host) %>%
   left_join(summary.field.original)  %>%
   mutate(Group_MOA_current_season = na_if(Group_MOA_current_season, "")) %>%
     arrange(ID) %>% 
   
   rename(N_iso_perfield =Num_original_isolates,  Group= Group_MOA_current_season) %>%   
  mutate(Origin = ifelse(
    ID %in% baseline_isolates_2,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host)) 


anyDuplicated(gamma$ID)

# Summarizing 1 BY ORIGIN
gamma_summary1 <- gamma %>% 
  group_by (Origin) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
# creating the table in pdf
# field_ID_data_bos_summary1 %>%
#   kable(format = "markdown") %>%    write2pdf("tetraconazole_outliers_summary_by_origin.pdf")
# Summarizing 2 by host
gamma_summary2 <- gamma %>% 
  group_by ( Host) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1))  %>% 
    ungroup() %>% 
              add_row(Host = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
#creating the table in pdf
# field_ID_data_bos_summary2 %>%
#   kable(format = "markdown") %>%    write2pdf("tetraconazole_outliers_summary_by_hosts.pdf")


# Summarizing 3  BY STATE
gamma_summary3 <- gamma %>% 
  group_by ( State) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              add_row(State = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))

#creating the table in pdf
# field_ID_data_bos_summary3 %>%
#   kable(format = "markdown") %>%    write2pdf("tetraconazole_outliers_summary_by_states.pdf")


# Summarizing 4  BY STATE  NE and host soybeans
gamma_summary4 <- gamma %>% 
  group_by (Origin, Host,State) %>% 
             summarize(N_isol = n()) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              filter(Host=="soybeans"|State == "NE") %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol))


#TM
# Using the function

TM.complete.2<- TM.complete%>% 
group_by(Origin)%>%
mutate(EC50DC_outlier = list(get_range2(EC50DC)))%>%
unnest() %>% 
filter(EC50DC >=  outlier) %>% ungroup() %>% 
  select(ID) %>% 
  bind_rows(TM.data) %>% 
ungroup() %>% 
  mutate( ID= as.numeric(ID)) %>% 
  unique()


###
angle <- TM.complete.2 %>%
  full_join(WM3_, by = "ID")  %>%    
  select(colnames(TM.complete.2), Field,  Year, State, Group_MOA_current_season, Host) %>%
   left_join(summary.field.original)  %>%
   mutate(Group_MOA_current_season = na_if(Group_MOA_current_season, "")) %>%
     arrange(ID) %>% 
      rename(N_iso_perfield =Num_original_isolates, Group= Group_MOA_current_season)

anyDuplicated(angle$ID)

# Summarizing 1 BY ORIGIN
angle_summary1 <- angle %>% 
  group_by (Origin) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
# creating the table in pdf
# field_ID_data_bos_summary1 %>%
#   kable(format = "markdown") %>%    write2pdf("TM_outliers_summary_by_origin.pdf")
# Summarizing 2 by host
angle_summary2 <- angle %>% 
  group_by ( Host) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1))  %>% 
    ungroup() %>% 
              add_row(Host = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))
#creating the table in pdf
# field_ID_data_bos_summary2 %>%
#   kable(format = "markdown") %>%    write2pdf("TM_outliers_summary_by_hosts.pdf")


# Summarizing 3  BY STATE
angle_summary3 <- angle %>% 
  group_by ( State) %>% 
             summarize(N_isol = n(), Percent = round(100 * n() / nrow(.), digits = 1)) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              add_row(State = "Total", N_isol = sum(.$N_isol), Percent = sum(.$Percent))

#creating the table in pdf
# field_ID_data_bos_summary3 %>%
#   kable(format = "markdown") %>%    write2pdf("TM_outliers_summary_by_states.pdf")


# Summarizing 4  BY STATE  NE and host soybeans
angle_summary4 <- angle %>% 
  group_by (Origin, Host,State) %>% 
             summarize(N_isol = n()) %>% 
             ungroup() %>%
              arrange(desc(N_isol)) %>% 
              filter(Host=="soybeans"|State == "NE") %>% 
              add_row(Origin = "Total", N_isol = sum(.$N_isol))





```

# doing the table required from Sydney

```{r}

a <- TM.complete.4$ID %in% tetraconazole.complete.4$ID
sum(a)
b<- TM.complete.4$ID %in% picoxystrobin.complete.4$ID
 sum(b)
c<- TM.complete.4$ID %in% boscalid.complete.4$ID
 sum(c)
#boscalid
boscalid.complete.4
  #tested
  boscalid.complete.4$ID #202

#outliersBOSCALID
   boscalid.complete.5$ID  #52


notoutlierbuttested_bos <-boscalid.complete.4$ID[! boscalid.complete.4$ID %in% boscalid.complete.5$ID  ]

no_tested_bos <-mu$ID[! mu$ID %in% boscalid.complete.4$ID ]

# Picoxystrobin
  
picoxystrobin.complete.4
  #tested
  picoxystrobin.complete.4$ID #204

#outlierspicoxystrobin
   picoxystrobin.complete.5$ID  #52


notoutlierbuttested_pico <-picoxystrobin.complete.4$ID[! picoxystrobin.complete.4$ID %in% picoxystrobin.complete.5$ID  ]

no_tested_pico <-alpha$ID[! alpha$ID %in% picoxystrobin.complete.4$ID ]

# Tetraconazole
  
tetraconazole.complete.4
  #tested
  tetraconazole.complete.4$ID #204

#outlierstetraconazole
   tetraconazole.complete.5$ID  #53


notoutlierbuttested_tetra <-tetraconazole.complete.4$ID[! tetraconazole.complete.4$ID %in% tetraconazole.complete.5$ID  ]

no_tested_tetra <-gamma$ID[! gamma$ID %in% tetraconazole.complete.4$ID ]

# TM
  
TM.complete.4
  #tested
  TM.complete.4$ID #205

#outliersTM
   TM.complete.5$ID  #53


notoutlierbuttested_TM <-TM.complete.4$ID[! TM.complete.4$ID %in% TM.complete.5$ID  ]

no_tested_TM <-angle$ID[! angle$ID %in% TM.complete.4$ID ]




FieldSS<- angle %>%
mutate(bos= case_when(
ID%in% boscalid.complete.5$ID ~ 1,
ID%in% notoutlierbuttested_bos~ 0,
ID%in% no_tested_bos  ~NA_real_ , 
TRUE ~ NA_real_),
pico= case_when(
ID%in% picoxystrobin.complete.5$ID ~ 1,
ID%in% notoutlierbuttested_pico ~ 0,
ID%in% no_tested_bos ~NA_real_ ,
TRUE ~ NA_real_), 
tetra= case_when(
ID%in% tetraconazole.complete.5$ID ~ 1,
ID%in% notoutlierbuttested_tetra ~ 0,
ID%in% no_tested_bos ~NA_real_ , 
TRUE ~ NA_real_), 
TM= case_when(
ID%in% TM.complete.5$ID ~ 1,
ID%in% notoutlierbuttested_TM ~ 0,
ID%in% no_tested_bos ~NA_real_ , 
TRUE ~ NA_real_)) %>% 
   filter(Group== "Group_one"|Group=="Group_3"|Group=="Group_7"|Group=="Group_11")

 # hello <- FieldSS %>%   filter(Funcide== "Group_one"|Funcide=="Group_3"|Funcide=="Group_7"|Funcide=="Group_11")
 
glimpse(FieldSS)
hello <- FieldSS %>%  select(bos, pico, tetra, TM)
water <- cbind(hello, bye)
fusarium <- water %>% filter(bye>=2) %>% arrange(bye) 


bye <- apply(hello, 1, sum)


hello3 <- FieldSS 
water2 <- cbind(hello3, bye2)
fusarium2 <- water2 %>% filter(bye2>=2) %>% arrange(bye2) 
View(fusarium2
    )

# fusarium%>%
#   write_csv("clean data/table_ouliers_together.csv")

Groupone <- FieldSS %>% filter(Group== "Group_one")
Groupone %>%
kable(format = "markdown",caption = "Table with outliers for each fungicide, NA= never tested, 0= not an outlier but tested, 1= outlier", padding = 0, align = "l") %>%
  write2pdf("Group_one.pdf")
# 
Group3 <- FieldSS %>% filter(Group== "Group_3")
Group3 %>%
kable(format = "markdown",caption = "Table with outliers for each fungicide, NA= never tested, 0= not an outlier but tested, 1= outlier", padding = 0, align = "l") %>%
  write2pdf("Group_3.pdf")
Group7 <- FieldSS %>% filter(Group== "Group_7")
Group7 %>%
kable(format = "markdown",caption = "Table with outliers for each fungicide, NA= never tested, 0= not an outlier but tested, 1= outlier", padding = 0, align = "l") %>%
  write2pdf("Group_7.pdf")
 Group11 <- FieldSS %>% filter(Group== "Group_11")
Group11 %>%
kable(format = "markdown",caption = "Table with outliers for each fungicide, NA= never tested, 0= not an outlier but tested, 1= outlier", padding = 0, align = "l") %>%
  write2pdf("Group_11.pdf")
# 
#        #creating the table in pdf
# FieldSS_ %>%
# kable(format = "markdown",caption = "Table with outliers for each fungicide, NA= never tested, 0= not an outlier but tested, 1= outlier", padding = 0, align = "l") %>%   
#   kable_styling(font_size = 5, full_width = 10 ) %>% 
#   write2pdf("summary_ouliers.pdf")
# 
# FieldSS_ <- FieldSS_ %>% ungroup
# pdf( "summary_outliers.pdf")
# FieldSS_ <- FieldSS_ %>% ungroup
# dev.off()
# 
# write.csv(FieldSS_, "clean data/summary_outliers.csv")
# 


```

