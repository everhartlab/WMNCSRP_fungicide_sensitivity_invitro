---
title: "R Notebook"
output: html_notebook
---

 

```{r}
library(tidyverse)
library(ggplot2)
library(ezec)
#library(NRES803)
library(broom)
library(ggridges)
library(cowplot)
library(gridExtra)
library(kableExtra)
library(arsenal)
library(DescTools)

knitr::opts_chunk$set(echo = TRUE)
```


```{r}
##  Reading and subsetting data 
boscalid.data <-
  read.csv("data/boscalid_serialdilution_baseline(validationdata).csv")
  boscalid.data <- subset(boscalid.data, select = -X)
  boscalid.data$repeats <- rep_len(1:4, length.out = 2184)
  boscalid.data$ID <- as.character(boscalid.data$ID)
  # renaming ID for the current names
 boscalid.data$ID[ boscalid.data$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74 the hat I used was specifically this, 74SS1
 boscalid.data$ID[ boscalid.data$ID =="74SS1"]  <- "74" 
 boscalid.data$ID[ boscalid.data$ID =="62-02"]  <- "2098" 
 boscalid.data$ID[ boscalid.data$ID =="62-03"]  <- "2099" 
 boscalid.data$ID[ boscalid.data$ID =="62-04"]  <- "2100" 
 boscalid.data$ID[ boscalid.data$ID =="78-01"]  <- "2139" 
 boscalid.data$ID[ boscalid.data$ID =="78-02"]  <- "2140" 
 boscalid.data$ID[ boscalid.data$ID =="78-05"]  <- "2143" 
 boscalid.data$ID[ boscalid.data$ID =="S-01"]  <- "2320" 
 boscalid.data$ID[ boscalid.data$ID =="H-01"]  <- "2220" 
 boscalid.data$ID[ boscalid.data$ID =="H-03"]  <- "2222" 
 boscalid.data$ID[ boscalid.data$ID =="H-04"]  <- "2223"
 boscalid.data$ID[ boscalid.data$ID =="I-20"]  <- "2362"
 boscalid.data$ID[ boscalid.data$ID =="419"]  <- "2385"
 boscalid.data$ID[ boscalid.data$ID =="413"]  <- "2386"
 boscalid.data$ID[ boscalid.data$ID =="W212"]  <- "2388"
 boscalid.data$ID[ boscalid.data$ID =="318"]  <- "2390"

  ## Discarding dose at 0.4 ppm and isolate 800 because it has just one experimental replication ##
  boscalid.data <- boscalid.data %>%
    filter(!dose ==  0.4 & !ID == 800) %>%
    group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
    filter(
    !ID == "I-20" |
    !experimental_replicate == 2 |
    !dose == 0 |
    !repeats == 3 ,
    !ID == 1033 |
    !experimental_replicate == 2 | !dose == 0 | !repeats == 4
    ) %>%
    mutate(growth = ((ecuatorial + polar) / 2))
    
#Reading and subsetting data picoxystrobin
  picoxystrobin.data <-
    read.csv("data/picoxystrobin_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
    picoxystrobin.data$repeats <- rep_len(1:4, length.out = 2016)
    picoxystrobin.data$ID <- as.character(picoxystrobin.data$ID)
    # renaming ID for the current names
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74 the hat I used was specifically this, 74SS1
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="74SS1"]  <- "74" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="62-02"]  <- "2098" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="62-03"]  <- "2099" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="62-04"]  <- "2100" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="78-01"]  <- "2139" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="78-02"]  <- "2140" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="78-05"]  <- "2143" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="S-01"]  <- "2320" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="H-01"]  <- "2220" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="H-03"]  <- "2222" 
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="H-04"]  <- "2223"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="I-20"]  <- "2362"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="419"]  <- "2385"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="413"]  <- "2386"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="W212"]  <- "2388"
 picoxystrobin.data$ID[ picoxystrobin.data$ID =="318"]  <- "2390"

    ##Discarding some isolates due to they are not there##
    picoxystrobin.data <- picoxystrobin.data %>%
      group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
      filter(
      !ID == "2143" |
      !experimental_replicate == 1 |
      !dose == 0 |
      !repeats == 2 ,
      !ID == "2100" |
      !experimental_replicate == 2 |
      !dose == 0 |
      !repeats == 3,
      !ID == "2223" |
      !experimental_replicate == 2 | !dose == 0 | !repeats == 2
      ) %>%
      mutate(growth = ((ecuatorial + polar) / 2))
      
#Reading and subsetting data tetraconazole
tetraconazole.data <-
  read.csv("data/tetraconazole_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
  tetraconazole.data <- subset(tetraconazole.data, select = -(X:X.1))
  tetraconazole.data$repeats <- rep_len(1:4, length.out = 2016)
  tetraconazole.data$ID <- as.character(tetraconazole.data$ID) 
  # renaming ID for the current names
 tetraconazole.data$ID[ tetraconazole.data$ID =="12B"]  <- "12" 
 #Although 74SS1 belong to # 74 the hat I used was specifically this, 74SS1
 tetraconazole.data$ID[ tetraconazole.data$ID =="74SS1"]  <- "74" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="62-02"]  <- "2098" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="62-03"]  <- "2099" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="62-04"]  <- "2100" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="78-01"]  <- "2139" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="78-02"]  <- "2140" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="78-05"]  <- "2143" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="S-01"]  <- "2320" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="H-01"]  <- "2220" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="H-03"]  <- "2222" 
 tetraconazole.data$ID[ tetraconazole.data$ID =="H-04"]  <- "2223"
 tetraconazole.data$ID[ tetraconazole.data$ID =="I-20"]  <- "2362"
 tetraconazole.data$ID[ tetraconazole.data$ID =="419"]  <- "2385"
 tetraconazole.data$ID[ tetraconazole.data$ID =="413"]  <- "2386"
 tetraconazole.data$ID[ tetraconazole.data$ID =="W212"]  <- "2388"
 tetraconazole.data$ID[ tetraconazole.data$ID =="318"]  <- "2390"

  
   ##Discarding some isolates due to they were not there##
  tetraconazole.data <- tetraconazole.data %>%
    group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
    filter(
    !ID == "2139" |
    !experimental_replicate == 1 |
    !dose == 0.5 ,
    !ID == "2139" |
    !experimental_replicate == 1 |
    !dose == 1 ,
    !ID == "2139" |
    !experimental_replicate == 1 | !dose == 2
    ) %>%
    mutate(growth = ((ecuatorial + polar) / 2))
#Reading and subsetting data TM
  TMdata <-
    read.csv("data/TM_serialdi_BL-WMN_survey-WMNCSRP(validationdata).csv")
    TMdata <- subset(TMdata, select = -(X:X.6))
    TMdata$repeats <- rep_len(1:4, length.out = 3192)
    TMdata$ID <- as.character(TMdata$ID)
   
    
 TMdata$ID[ TMdata$ID =="12B"]  <- "12" 
 TMdata$ID[ TMdata$ID =="74SS1"]  <- "74" 
 TMdata$ID[ TMdata$ID =="62-02"]  <- "2098" 
 TMdata$ID[ TMdata$ID =="62-03"]  <- "2099" 
 TMdata$ID[ TMdata$ID =="62-04"]  <- "2100" 
 TMdata$ID[ TMdata$ID =="78-01"]  <- "2139" 
 TMdata$ID[ TMdata$ID =="78-02"]  <- "2140" 
 TMdata$ID[ TMdata$ID =="78-05"]  <- "2143" 
 TMdata$ID[ TMdata$ID =="S-01"]  <- "2320" 
 TMdata$ID[ TMdata$ID =="H-01"]  <- "2220" 
 TMdata$ID[ TMdata$ID =="H-03"]  <- "2222" 
 TMdata$ID[ TMdata$ID =="H-04"]  <- "2223"
 TMdata$ID[ TMdata$ID =="I-20"]  <- "2362"
 TMdata$ID[ TMdata$ID =="419"]  <- "2385"
 TMdata$ID[ TMdata$ID =="413"]  <- "2386"
 TMdata$ID[ TMdata$ID =="W212"]  <- "2388"
 TMdata$ID[ TMdata$ID =="318"]  <- "2390"

     ## Discarding some isolates due to they are not there##
    TMdata <- TMdata %>%
      group_by(ID, experimental_replicate, dose, ecuatorial, polar, repeats) %>%
      filter(!experimental_replicate == 1 |
      !dose == 1.5 | !repeats == 3) %>%
      mutate(growth = ((ecuatorial + polar) / 2))
      
#Reading and subsetting data discriminatory dose use
    survey.data <-  read.csv("data/DD_survey-WMNCSRP.csv")
    survey.data <- survey.data %>%
    group_by(
    ID,
    repeats,
    experimental_replicate,
    sham.ecuatorial,
    sham.polar,
    picoxystrobin.ecuatorial,
    picoxystrobin.polar,
    boscalid.ecuatorial,
    boscalid.polar,
    tetraconazole.ecuatorial,
    tetraconazole.polar,
    TM.ecuatorial,
    TM.polar,
    control.ecuatorial,
    control.polar
    ) %>%
    mutate(
    sham.growth = ((sham.ecuatorial + sham.polar) / 2),
    picoxystrobin.growth = ((
    picoxystrobin.ecuatorial + picoxystrobin.polar
    ) / 2),
    boscalid.growth = ((boscalid.ecuatorial + boscalid.polar) / 2),
    tetraconazole.growth = ((
    tetraconazole.ecuatorial + tetraconazole.polar
    ) / 2),
    TM.growth = ((TM.ecuatorial + TM.polar) / 2),
    control.growth = ((control.ecuatorial + control.polar) / 2)
    ) %>%
    ungroup()
    
    survey.data.2 <- survey.data
     survey.data.2$ID <- as.character(survey.data.2$ID)
    survey.data.2$ID[ survey.data.2$ID =="54C"]  <- "2453"
     survey.data.2$ID[ survey.data.2$ID =="65B"]  <- "2528"
      survey.data.2$ID[ survey.data.2$ID =="51C"]  <- "2449"
       survey.data.2$ID[ survey.data.2$ID =="71B"]  <- "2505"
        survey.data.2$ID[ survey.data.2$ID =="64D"]  <- "2518"
         survey.data.2$ID[ survey.data.2$ID =="53B"]  <- "2536"
          survey.data.2$ID[ survey.data.2$ID =="60A"]  <- "2559"
           survey.data.2$ID[ survey.data.2$ID =="H-01"]  <- "2220"
            survey.data.2$ID[ survey.data.2$ID =="H-03"]  <- "2222"
             survey.data.2$ID[ survey.data.2$ID =="419"]  <- "2385"
              survey.data.2$ID[ survey.data.2$ID =="78-02"]  <- "2140"

             survey.data.3 <- survey.data.2 %>% mutate(ID = as.numeric(ID))
               WM <- read.csv("data/WM-fixingproductnamesID2573_modifyingforactiveingredient_8.csv", stringsAsFactors = TRUE)
WM$Collection_ID <- str_squish(WM$Collection_ID)
WM2 <- 
WM %>% filter(
  !Collection_ID == "5A",
  !Collection_ID == "12Ba",
  !Collection_ID == "12Bb",
  !Collection_ID == "13Bb",
  !Collection_ID == "13Ba",
  !Collection_ID == "13Bb",
  !Collection_ID == "13Bc",
  !Collection_ID == "13E",
  !Collection_ID == "13Ea",
  !Collection_ID == "13Eb",
  !Collection_ID == "13Ec",
  !Collection_ID == "15a",
  !Collection_ID == "15b",
  !Collection_ID == "15c",
  !Collection_ID == "19a",
  !Collection_ID == "19b",
  !Collection_ID == "19c",
  !Collection_ID == "74",
  !Collection_ID == "74-SS-2",
  # removed this one becuase the one used was 74-SS1
  !Collection_ID == "74a",
  !Collection_ID == "74b",
  !Collection_ID == "74c",
  !Collection_ID == "136a",
  !Collection_ID == "136b",
  !Collection_ID == "136c",
  !Collection_ID == "143a",
  !Collection_ID == "143b",
  !Collection_ID == "143c",
  !Collection_ID == "143d",
  !Collection_ID == "143e",
  !Collection_ID == "143f",
  !Collection_ID == "147b",
  !Collection_ID == "147c",
  !Collection_ID == "152a",
  !Collection_ID == "152b",
  !Collection_ID == "152c",
  !Collection_ID == "152d",
  !Collection_ID == "152e",
  !Collection_ID == "152f",
  !Collection_ID == "152g",
  !Collection_ID == "152h",
  !Collection_ID == "152i",
  !Collection_ID == "152j",
  !Collection_ID == "152JR",
  !Collection_ID == "160a",
  !Collection_ID == "160b",
  !Collection_ID == "160c",
  !Collection_ID == "161a",
  !Collection_ID == "161b",
  !Collection_ID == "161c",
  !Collection_ID == "167a",
  !Collection_ID == "167b",
  !Collection_ID == "167c",
  !Collection_ID == "184a",
  !Collection_ID == "184b",
  !Collection_ID == "184c",
  !Collection_ID == "202a",
  !Collection_ID == "202b",
  !Collection_ID == "202c",
  !Collection_ID == "232B",
  !Collection_ID == "245a",
  !Collection_ID == "245b",
  !Collection_ID == "245c",
  !Collection_ID == "247a",
  !Collection_ID == "247b",
  !Collection_ID == "247c",
  !Collection_ID == "248a",
  !Collection_ID == "248b",
  !Collection_ID == "262a",## Any of these one because they are S trifoliorum
  !Collection_ID == "262b",
  !Collection_ID == "264a",
  !Collection_ID == "264b",
  !Collection_ID == "136c",
  !Collection_ID == "264c",
  !Collection_ID == "274a",
  !Collection_ID == "274b",
  !Collection_ID == "334a",
  !Collection_ID == "334b",
  !Collection_ID == "334c",
  !Collection_ID == "336a",
  !Collection_ID == "336b",
  !Collection_ID == "336c",
  !Collection_ID == "339a",
  !Collection_ID == "339b",
  !Collection_ID == "339c",
  !Collection_ID == "339d",
  !Collection_ID == "339e",
  !Collection_ID == "339f",
  !Collection_ID == "341a",
  !Collection_ID == "341b",
  !Collection_ID == "341c",
  !Collection_ID == "324a",
  !Collection_ID == "342a",
  !Collection_ID == "342b",
  !Collection_ID == "342c",
  !Collection_ID == "346a",
  !Collection_ID == "346b",
  !Collection_ID == "346c",
  !Collection_ID == "353b",
  !Collection_ID == "354a",
  !Collection_ID == "354b",
  !Collection_ID == "354c",
  !Collection_ID == "360b",
  !Collection_ID == "360c",
  !Collection_ID == "361b",
  !Collection_ID == "361c",
  !Collection_ID == "362b",
  !Collection_ID == "362c",
  !Collection_ID == "363b",
  !Collection_ID == "363c",
  !Collection_ID == "364b",
  !Collection_ID == "364c",
  !Collection_ID == "365b",
  !Collection_ID == "365c",
  !Collection_ID == "366b",
  !Collection_ID == "366c",
  !Collection_ID == "367b",
  !Collection_ID == "367c",
  !Collection_ID == "368b",
  !Collection_ID == "368c",
  !Collection_ID == "369b",
  !Collection_ID == "369c",
  !Collection_ID == "370b",
  !Collection_ID == "370c",
  !Collection_ID == "371b",
  !Collection_ID == "371c",
  !Collection_ID == "372b",
  !Collection_ID == "372c",
  !Collection_ID == "373b",
  !Collection_ID == "373c",
  !Collection_ID == "374b",
  !Collection_ID == "374c",
  !Collection_ID == "375a",
  !Collection_ID == "375b",
  !Collection_ID == "376b",
  !Collection_ID == "376c",
  !Collection_ID == "377b",
  !Collection_ID == "377c",
  !Collection_ID == "400a",
  !Collection_ID == "400b",
  !Collection_ID == "973A",
  !Collection_ID == "973B",
  !Collection_ID == "973C",
  !Collection_ID == "973D",
  !Collection_ID == "973E",
  !Collection_ID == "974A",
  !Collection_ID == "974B",
  !Collection_ID == "974C",
  !Collection_ID == "974D",
  !Collection_ID == "974E",
  !Collection_ID == "975A",
  !Collection_ID == "975B",
  !Collection_ID == "975C",
  !Collection_ID == "975D",
  !Collection_ID == "975E",
  !Collection_ID == "976A",
  !Collection_ID == "976B",
  !Collection_ID == "976C",
  !Collection_ID == "976D",
  !Collection_ID == "976E",
  !Collection_ID == "977A",
  !Collection_ID == "977B",
  !Collection_ID == "977C",
  !Collection_ID == "977D",
  !Collection_ID == "977E",
  !Collection_ID == "978A",
  !Collection_ID == "978B",
  !Collection_ID == "978C",
  !Collection_ID == "978D",
  !Collection_ID == "978E",
  !Collection_ID == "979A",
  !Collection_ID == "979B",
  !Collection_ID == "979C",
  !Collection_ID == "979D",
  !Collection_ID == "979E",
  !Collection_ID == "1048",
  !Collection_ID == "1049",
  !Collection_ID == "1227",
  !Collection_ID == "1228",
  !Collection_ID == "2217",
  !Collection_ID == "2219",
  !Collection_ID == "2225",
  !Collection_ID == "2226",
  !Collection_ID == "2230",
  !Collection_ID == "2245",
  !Collection_ID == "2307",
  !Collection_ID == "2320",
  !Collection_ID == "2325",
  !Collection_ID == "2327",
  !Collection_ID == "2329",
  !Collection_ID == "2352",
  !Collection_ID == "2366",
  !Collection_ID == "2367",
  !Collection_ID == "2369",
  !Collection_ID == "2373",
  !Collection_ID == "2375",
  !Collection_ID == "2380",
  !Collection_ID == "2387",
  !Collection_ID == "2389",
  !Collection_ID == "2392",
  !Collection_ID == "973D"
  ) %>% 
  rename(ID= Collection_ID)
  
WM2$ID[ WM2$ID =="12B"]  <- "12"
WM2$ID[ WM2$ID =="13B"]  <- "13"
WM2$ID[ WM2$ID =="74-SS-1"]  <- "74"
WM2$ID[ WM2$ID =="125 SS-4"]  <- "125"
WM2$ID[ WM2$ID =="232A"]  <- "232"
WM2$ID[ WM2$ID =="359b"]  <- "359"
WM2$ID[ WM2$ID =="360a"]  <- "360"
WM2$ID[ WM2$ID =="361a"]  <- "361"
WM2$ID[ WM2$ID =="362a"]  <- "362"
WM2$ID[ WM2$ID =="363a"]  <- "363"
WM2$ID[ WM2$ID =="364a"]  <- "364"
WM2$ID[ WM2$ID =="365a"]  <- "365"
WM2$ID[ WM2$ID =="366a"]  <- "366"
WM2$ID[ WM2$ID =="367a"]  <- "367"
WM2$ID[ WM2$ID =="368a"]  <- "368"
WM2$ID[ WM2$ID =="369a"]  <- "369"
WM2$ID[ WM2$ID =="370a"]  <- "370"
WM2$ID[ WM2$ID =="371a"]  <- "371"
WM2$ID[ WM2$ID =="372a"]  <- "372"
WM2$ID[ WM2$ID =="373a"]  <- "373"
WM2$ID[ WM2$ID =="374a"]  <- "374"
WM2$ID[ WM2$ID =="375c"]  <- "375"
WM2$ID[ WM2$ID =="376a"]  <- "376"
WM2$ID[ WM2$ID =="377a"]  <- "377"

WM3 <- WM2 %>% mutate(ID = as.numeric(ID))
```

##  Setting the groups of isolates
```{r}
#replacing with the original ID, fr example, instead of 12b, now 12
baseline_isolates <- c(1, 8, 12, 20, 21, 74, 87, 118, 123, 129, 449, 461, 467, 475, 558, 564, 568, 581, 645, 667, 800)

survey_isolates <-  c( 2385, 2386, 2098, 2099, 2100, 2139, 2140, 2143, 2220, 2222, 2223, 2320, 2362, 2388, 2390 )

Farmer_fields <- c(136:442, 455, 456, 466, 468, 470, 471, 478:554, 602:610, 612:635, 671, 672, 682:690, 695:797, 810:823, 834, 835, 848:1024, 1255: 1326, 1491: 1500, 1661:1670, 1831: 2246, 2303: 2342,2362: 2381, 2393: 2573)

baseline_isolates <- c(1: 136, 444: 454, 457: 465, 467, 469, 472:477, 555:601, 611, 636:670, 673: 680, 691:694 , 798: 809,  824: 833, 836: 847)

drybean <- c(1, 5, 12,13:118, 123:128, 133:135, 145, 146, 152, 155:160, 182: 185, 194:200, 205, 220, 223, 248, 253:255, 274, 279, 280, 290, 294, 304: 309, 323, 358, 393, 395, 396, 397, 400:402, 405, 408, 409, 434, 443:465, 467, 469: 493, 495:505, 555:613, 615: 760, 762: 819, 824:833, 835:855, 858:921, 966: 971, 980, 981, 985: 996, 998: 1009, 1220:1225 , 1857: 1940, 2242: 2569)

soybean <- c(143, 147, 181, 187, 188, 189,202, 257: 259, 264:268, 276, 281, 289, 293, 295, 310 , 399, 412:417, 419, 425:427, 439, 440, 494, 506:554, 834, 972:979, 982, 997, 1010: 1022, 1025:1219, 1229: 1856, 1941: 2241 )


#Fungicides single mode of action
Group_one <- c("thiophanate_methyl")
Group_3 <- c( "prothioconazole", "tetraconazole", "flutriafol", "propiconazole", "tebuconazole", "difenoconazole")
Group_7 <- c("fluxapyroxad", "boscalid")
Group_11 <- c("picoxystrobin", "azoxystrobin", "fluoxastrobin", "pyraclostrobin", "trifloxystrobin")

not_considered <- c("potassium phosphite")

#Mixxes of fungicides IN COMERCIAL PRODUCTS

 Group_3_Group_11 <-  c(
   "flutriafol + fluoxastrobin",
   "tetraconazole + pyraclostrobin", #there 2 fungicides: single MOA(tetraconazole) + single MOA( pyraclostrobin) #Put attention for the mixxes analyses with 2 single MOA!!
   "propiconazole + azoxystrobin",
"prothioconazole + trifloxystrobin", 
"tetraconazole + fluatriafol + fluxastrobin", #there 2 fungicides: single MOA(tetraconazole) + mix( flutriafol + fluxastrobin) #Put attention for the mixxes mixxes analyses with 2 single MOA!!
"difenoconazole + azoxystrobin")
 
Group_7_Group_11 <- c(
  "fluxapyroxad + pyraclostrobin", 
  "pyraclostrobin + fluxapyroxad + pyraclostrobin")  #there 2 fungicides: single MOA(pyraclostrobin) + mix( fluxapyroxad + pyraclostrobin) #Put attention for the mixxes mixxes analyses with 2 single MOA!!                     
                     
 Group_3_not_considered <- "tebuconazole + potassium phosphite"
 
  unknown <- c("No_info")
 
 
levels(WM3$Fungicide_current_season)[levels(WM3$Fungicide_current_season) == "No_info"] <- "unknown"

levels(WM3$molecule.s._current_season)[levels(WM3$molecule.s._current_season) == ""] <- "unknown"

levels(WM3$Fungicide_previous_seasons)[levels(WM3$Fungicide_previous_seasons) == ""] <- "unknown"


levels(WM3$molecule.s._previous_seasons)[levels(WM3$molecule.s._previous_seasons) == ""] <- "unknown"


WM3$molecule.s._current_season <- as.character(WM3$molecule.s._current_season)
WM3_ <- WM3%>%
  mutate(
    Group_MOA_current_season = case_when(
       molecule.s._current_season%in% Group_one ~ "Group_one",# filtering and naming "the name of the group" in case of in
       molecule.s._current_season%in% Group_3~ "Group_3",
       molecule.s._current_season%in% Group_7 ~ "Group_7",
       molecule.s._current_season%in% Group_11 ~ "Group_11", molecule.s._current_season%in% Group_3_Group_11~ "Group_3&Group_11",
       molecule.s._current_season%in% Group_7_Group_11~ "Group_7&Group_11",
       molecule.s._current_season%in% Group_3_not_considered~ "Group_3&not_considered",
       molecule.s._current_season%in% unknown~ "unknown",
             TRUE ~ "unknown"# in case of not, naming "not_selected""
    )
  )   
    


```
##  Creating a function for using the outputs of boxplot.stats function and notice the outliers

```{r}
get_range <- function(mynumber) {
  bb <- boxplot.stats(mynumber)
  cc <- bb$stats
  dd <- max(cc)
  ee <- min(cc)
  return(data.frame(upper = dd, lower = ee))
}

```

##  Analysis by fungicide
#  Boscalid
```{r}
#Boscalid fungicide taking the outliers from the 8 observations of each one, it reduces from to #
boscalid.filtered  <- boscalid.data %>%
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>% 
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>%
  ungroup() %>%
  select(c(ID, experimental_replicate, repeats, dose, response))

#Boxplot by experimental replicate,  I would need to remove one replicate from 2d experimental replicate for ID= 1032, one replicate from each experimental replicate for ID = 2222 and one repeat from 2nd experimental replicate for ID= 1032
#Boxplot by repeats,   I would need to remove For ID= 1032, the 4th repeat, and For ID= H-03,  the repeat 3,
xx <- EC_table(boscalid.filtered, form = response ~ dose)
boscalid.xx <-
  xx %>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50) %>%
   group_by(ID, EC50) %>%
  mutate(group = ifelse(
    ID %in% baseline_isolates,
    "baseline",
    ifelse(
      ID %in% survey_isolates,
      "survey_isolates",
      "treatmentyear2016_isolates"
      ))) %>% ungroup() %>% 
     mutate(fungicide = "Boscalid") %>% 
  mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group))

```

##  Procedure to get the Discrimantory Concentration (DC)  

#  Boscalid 
```{r}
##Getting relative growth column at each dose where RG = Relative Growth, eg. RG0.025 = Relative Growth at 0.025 ppm##
RG <-
  boscalid.filtered %>% group_by(ID, dose) %>% summarise(mean_response = mean(response, na.rm = TRUE)) %>%
  spread(dose, mean_response) %>%
  mutate(RG0.025 = ((`0.025` / `0`) * 100)) %>%    
     mutate(RG0.05 = ((`0.05` / `0`) * 100)) %>%
        mutate(RG0.05 = ((`0.05` / `0`) * 100)) %>%  
          mutate(RG0.1 = ((`0.1` / `0`) * 100)) %>%
            mutate(RG0.2 = ((`0.2` / `0`) * 100)) %>%
              mutate(RG0.8 = ((`0.8` / `0`) * 100))
#Since here EC50 is known as Estimate EC50 from EC50 table 
final.boscalid <-#joining
  left_join (RG, boscalid.xx) %>% mutate(logEC50 = (log(EC50))) %>% rename(Estimate.50 = EC50)

####################################################################################
###Dose chosen as DC. Although there is one dose with higher r2, there is no differnec between and this was selected
# Linear model of log EC50 and relative growth at 0.2 ppm, check normality and homogeneity of variances
#pdf("boscalid_assumptions_linearmodel_dosechoseasDC_with_outlayers.pdf")
finalRG0.2 <- lm(logEC50 ~ RG0.2, final.boscalid)
summary(finalRG0.2)
plot(finalRG0.2)
#check_assumptions(finalRG0.2)
#dev.off()
##taking out outliers from Q-Q PLOT $ LEVERAGE TEST, ISOLATES # 1032 from treatment, 2222 & 2223 from survey##
#pdf("boscalid_assumptions_linearmodel_dosechoseasDC.pdf")
final.boscalid.clean <-
  final.boscalid %>% filter(!ID == "1032", !ID == "2222",!ID == "2223")
 
 finalRG0.2 <- lm(logEC50 ~ RG0.2, final.boscalid.clean)
  summary(finalRG0.2)
  plot(finalRG0.2)
  #check_assumptions(finalRG0.2)
  #dev.off()
# Linear Regression graph of log EC50 and relative growth at 0.2 ppm

  ggplot(finalRG0.2, aes(x = RG0.2, y = logEC50)) +  geom_point() + geom_smooth(method = "lm") +  theme(
    plot.title = element_text(
    size = 12,
    face = "bold",
    hjust = 0.5,
    family = "Verdana"
    ),
    axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
    axis.text = element_text(
    face = "bold",
    size = 14,
    family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
    ) + labs(title = "Linear regression between EC50 values & relative growth of Boscalid at 0.2 ppm", x =
    "Relative growth (%)", y = "Log EC50")
    

# Getting the EC50DC according to the model
final.boscalid.DC <-
  final.boscalid.clean %>% mutate(Estimate.50DC = exp((finalRG0.2[[1]][[1]]) + ((finalRG0.2[[1]][[2]]) * RG0.2))) %>%# here I need to do this dynamic
  select(ID, Estimate.50DC, Estimate.50)

# Linear model of EC50  and EC50DC, check normality and homogeneity of variances
final.boscalid.DC.0.2 <- lm (Estimate.50DC ~ Estimate.50, final.boscalid.DC ) 
summary(final.boscalid.DC.0.2)
plot(final.boscalid.DC.0.2)
#check_assumptions(final_boscalid_DC_0.2)
# Linear Regression graph of EC50 and EC50DC
#pdf("Linear regression of boscalid 0.2 ppm.pdf")  
ggplot(final.boscalid.DC.0.2, aes(x = Estimate.50, y = Estimate.50DC)) +  theme(
  plot.title = element_text(
  size = 14,
  face = "bold",
  hjust = 1,
  family = "Verdana"
  ),
  axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
  axis.text = element_text(
  face = "bold",
  size = 14,
  family = "Verdana"
  ),
  panel.background = element_rect(fill = "white", colour = "grey50")
  ) + labs(title = "Linear regression between EC50 and EC50(D) values of Boscalid ", x =
  "EC50 (ppm)", y = "EC50(D) (ppm)") + geom_point(shape = 24) + geom_smooth(method = "lm")
  

```
##  Boscalid with survey (pre-test Fungicide) inlcuding Farmer fields and Fungicide field trials
```{r}
boscalid.data <- survey.data.3 %>%
  select(ID,
         repeats,
         experimental_replicate,
         boscalid.growth,
         control.growth) %>%
  rename(response = boscalid.growth, control = control.growth) %>% 
  mutate(ID= as.character(ID))


###
alga <-  boscalid.filtered %>% filter(dose== 0.2 | dose== 0) %>%  spread(dose, response) %>% rename(control= '0',  response = '0.2') %>% select(ID, repeats, experimental_replicate,  response,control) %>% 
  mutate(ID= as.character(ID))


## That wa using the EC50D of the serial dilution but Iam going to use Real EC50 of those
 
 #boscalid_data <- boscalid_data %>% full_join (alga)
 
# Using the previous  function in order to take out the outliers
boscalid.filtered.survey <- boscalid.data %>%
  group_by(ID) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  mutate(control_range = list(get_range(control))) %>%
  unnest() %>%
  filter(response <= upper &
           response >= lower,
         control <= upper1 & control >= lower1) %>%
  ungroup() %>%
  select(c(ID, experimental_replicate, repeats, response, control))

#  Becasue of that taking outlayers by and then
boscalid.filtered. <- boscalid.filtered.survey %>%
  group_by(ID) %>%
  summarise(
  mean_response = mean(response, na.rm = TRUE),
  mean_control = mean(control, na.rm = TRUE)
  ) %>%
  mutate(RG = (mean_response / mean_control) * 100) %>%
  mutate(Estimate.50DC = exp (finalRG0.2[[1]][[1]] + finalRG0.2[[1]][[2]] * RG)) %>%
  select(c(ID, Estimate.50DC))

```
##  Analysis by fungicide
#  Picoxystrobin
```{r}
#Picoxystrobin  fungicide taking the outlayers from the 8 observations of each one, it reduces from 2013 to 1959 
picoxystrobin.filtered <- picoxystrobin.data %>%
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>%
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, repeats, dose, response))


# Getting EC50 by EC_table #
yy <- EC_table(picoxystrobin.filtered, form = response ~ dose)

picoxystrobin.yy <-
  yy %>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50)%>%
  select(c("ID", "EC50")) %>% group_by(ID, EC50) %>% mutate(group = ifelse(
  ID %in% baseline_isolates,
  "baseline",
  ifelse(
  ID %in% survey_isolates,
  "survey_isolates",
  "treatmentyear2016_isolates"
  )
  )) %>% ungroup() %>% mutate(fungicide = "Picoxystrobin") %>%   mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group))

  


```
##  Procedure to get the Discriminatory Concentration (DC) 
#  Picoxystrobin
```{r}
#Getting relative growth column at each dose where RG= Relative Growth, eg. RG0.01= Relative Growth at 0.01 ppm
RG <-
  picoxystrobin.filtered %>% group_by(ID, dose) %>% summarise(mean_response = mean(response, na.rm = TRUE)) %>% spread(dose, mean_response) %>%
  mutate(RG0.01 = ((`0.01` / `0`) * 100)) %>%
    mutate(RG0.02 = ((`0.02` / `0`) * 100)) %>%  
      mutate(RG0.04 = ((`0.04` / `0`) * 100)) %>%
        mutate(RG0.06 = ((`0.06` / `0`) * 100)) %>%
          mutate(RG0.1 = ((`0.1` / `0`) * 100))
final.picoxystrobin <- #joining table
  left_join (RG, picoxystrobin.yy) %>% mutate(logEC50 = (log(EC50))) %>% rename(Estimate.50 = EC50)

##################################################################################
#Dose chosen as DC
# Linear model of log EC50 and relative growth at 0.01 ppm, check normality and homogeneity of variances
#pdf("picoxystrobin_assumptions_linearmodel_dosechoseasDC_with_outlayers.pdf")
finalRG0.01 <- lm(logEC50 ~ RG0.01, final.picoxystrobin)
summary(finalRG0.01)
plot(finalRG0.01)
#check_assumptions(finalRG0.01)
#dev.off()
##taking out outlayers from Q-Q PLOT $ LEVERAGE TEST, ISOLATES # 1032 from treatment, 558 & 581 from baseline##
#pdf("picoxystrobin_assumptions_linearmodel_dosechoseasDC.pdf")
final.picoxystrobin.clean <- final.picoxystrobin %>% filter( !ID == "1032",!ID == "558", !ID == "581" ) 
finalRG0.01 <- lm(logEC50 ~ RG0.01, final.picoxystrobin.clean)
summary(finalRG0.01)
plot(finalRG0.01)

# Getting the EC50DC according to the model
final.picoxystrobin.DC <-
  final.picoxystrobin.clean %>% mutate(Estimate.50DC = exp(finalRG0.01[[1]][[1]] + finalRG0.01[[1]][[2]] *
  RG0.01)) %>% select(ID, Estimate.50DC, Estimate.50)
  # Linear model of EC50  and EC50DC, check normality and homogeneity of variances
final.picoxystrobin.DC.0.01 <- lm (Estimate.50DC ~ Estimate.50, final.picoxystrobin.DC)
summary(final.picoxystrobin.DC.0.01 )
plot(final.picoxystrobin.DC.0.01)
#check_assumptions(final_picoxystrobin_DC_0.01 )
#pdf("Linear regression of picoxystrobin 0.01 ppm.pdf")  
# Linear Regression graph of EC50 and EC50DC
ggplot(final.picoxystrobin.DC.0.01,
       aes(x = Estimate.50, y = Estimate.50DC)) +  theme(
       plot.title = element_text(
       size = 14,
       face = "bold",
       hjust = 1,
       family = "Verdana"
       ),
       axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
       axis.text = element_text(
       face = "bold",
       size = 14,
       family = "Verdana"
       ),
       panel.background = element_rect(fill = "white", colour = "grey50")
       ) + labs(title = "Linear regression between EC50 and EC50(D) values of Picoxystrobin ", x =
       "EC50 (ppm)", y = "EC50(D) (ppm)") + geom_point() + geom_smooth(method = "lm")
       
#dev.off()

```
#  Picoxystrobin With Survey(Pre-Test Fungicide) include Farmer fields and Fungicide field trials
```{r}
picoxystrobin.data <- survey.data.3 %>%
  select(
  ID,
  repeats,
  experimental_replicate,
  picoxystrobin.growth,
  sham.growth,
  control.growth
  ) %>%
  rename(response = picoxystrobin.growth, control = sham.growth) %>% select(-control.growth) %>% 
  mutate(ID= as.character(ID))
###
protozoa <-  picoxystrobin.filtered %>% filter(dose== 0.01 | dose== 0) %>%  spread(dose, response) %>% rename(control= '0',  response = '0.01') %>% select(ID, repeats, experimental_replicate,  response,control ) %>% 
  mutate(ID= as.character(ID))


# That was using the EC50D of the serial dilution but Iam going to use Real EC50 of those
 
 

# Using the function in order to take out the outliers
picoxystrobin.filtered.survey <- picoxystrobin.data %>%
  group_by(ID) %>%
    mutate(response_range = list(get_range(response))) %>%
      unnest() %>%
        mutate(control_range = list(get_range(control))) %>%
          unnest() %>%
            filter(response <= upper &
                response >= lower,
                    control <= upper1 & control >= lower1) %>%
                      ungroup() %>%
                        select(c(ID, experimental_replicate, repeats, response, control))
  #picoxystrobin_filtered_survey_plusbaseline
picoxystrobin.filtered. <- picoxystrobin.filtered.survey %>%
  group_by(ID) %>%
    summarise(
      mean_response = mean(response, na.rm = TRUE),
      mean_control = mean(control, na.rm = TRUE)
       ) %>%
         mutate(RG = (mean_response / mean_control) * 100) %>%
           mutate(Estimate.50DC = exp (finalRG0.01[[1]][[1]] + finalRG0.01[[1]][[2]] * RG)) %>%
             select(c(ID, Estimate.50DC)) %>%
               ungroup()
 

```
##  Analysis by fungicide
#  Tetraconazole
```{r}
tetraconazole.filtered <- tetraconazole.data %>%
  rename(response = growth) %>%
  group_by(ID, dose) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  filter(response <= upper & response >= lower) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, repeats, dose, response))

bb<- EC_table(tetraconazole.filtered, form = response ~ dose)

tetraconazole.bb <-
  bb %>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50)%>%
  select(c("ID", "EC50")) %>%  group_by(ID, EC50) %>% mutate(group = ifelse(
    ID %in% baseline_isolates,
    "baseline",
    ifelse(
    ID %in% survey_isolates,
    "survey_isolates",
    "treatmentyear2016_isolates"
    )
    )) %>% ungroup() %>% mutate(fungicide = "Tetraconazole") %>% mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group))
```
##  Procedure to get the Discrimanatory Concentration (DC) 
#  Tetraconazole
```{r}
RG <-
  tetraconazole.filtered %>% 
   group_by(ID, dose) %>%
    summarise(mean_response = mean(response, na.rm = TRUE)) %>% 
     spread(dose, mean_response) %>%
      mutate(RG0.5 =((`0.5` / `0`) * 100)) %>% mutate(RG1 = ((`1` / `0`) * 100)) %>%       mutate(RG2 =((`2` / `0`) * 100)) %>% 
  mutate(RG3 = ((`3` / `0`) * 100)) %>% 
  mutate(RG5 =((`5` / `0`) * 100)) 

#Since here EC50 is known as Estimate EC50 from EC50 table

# #Ordering the table##
#tetraconazole_bb <-  bb %>%
 # select(-Estimate.10, -SE.10, -Estimate.90, -SE.90)
#names(tetraconazole_bb)[names(tetraconazole_bb) == "sample"] <- "ID"
final.tetraconazole <-#joining
  left_join (RG, tetraconazole.bb) %>% mutate(logEC50 = (log(EC50))) %>% rename(Estimate.50 = EC50)
#pdf("tetraconazole_assumptions_linearmodel_each_dose&Linear_regression_with_best_model.pdf")



################################################################################
#Dose chosen as DC
# Linear model of log EC50 and relative growth at 2 ppm, check normality and homogeneity of variances
#pdf("tetraconazole_assumptions_linearmodel_dosechoseasDC_with_outlayers.pdf")
finalRG2 <- lm(logEC50 ~ RG2, final.tetraconazole)
summary(finalRG2)
plot(finalRG2)
#check_assumptions(finalRG2)
#dev.off()
##taking out outlayers from Q-Q PLOT & LEVERAGE TEST, ISOLATES #  21 , 558 & 667 from baseline##
#pdf("tetraconazole_assumptions_linearmodel_dosechoseasDC.pdf")
final.tetraconazole.clean <- final.tetraconazole %>% filter( !ID == "21",!ID == "558", !ID == "667" ) 
finalRG2 <- lm(logEC50 ~ RG2, final.tetraconazole.clean)
summary(finalRG2)
plot(finalRG2)
#check_assumptions(finalRG2)
#dev.off()
# Linear Regression graph of log EC50 and relative growth at 2 ppm
ggplot(finalRG2, aes(x = RG2, y =  logEC50)) +  theme(plot.title = element_text(size = 16, face = "bold", hjust = 1))  + labs(title = "Linear regression of tetraconazole 2 ppm", x =
                                                                                                                                "Relative growth(%)", y = "logEC50") + theme (axis.title.x = element_text(size = 12, face = "bold", hjust = 0.5)) + theme(axis.title.y = element_text(size = 12, face = "bold", hjust = 0.5)) +
                                                                                                                                theme(axis.text.x = element_text(size = 12)) + theme(axis.text.y = element_text(size = 12)) + theme (axis.line = element_line(colour = "grey50", size = 1)) +
                                                                                                                                geom_point() + geom_smooth(method = "lm")
                                                                              # Getting the EC50DC according to the model
final.tetraconazole.DC <- final.tetraconazole.clean %>% mutate(Estimate.50DC = exp(finalRG2[[1]][[1]] + finalRG2[[1]][[2]]*RG2)) %>% select(ID, Estimate.50DC, Estimate.50)
# Linear model of EC50  and EC50DC, check normality and homogeneity of variances
final.tetraconazole.DC.2 <- lm (Estimate.50DC ~ Estimate.50, final.tetraconazole.DC)
summary(final.tetraconazole.DC.2)
plot(final.tetraconazole.DC.2)
#check_assumptions(final_tetraconazole_DC_2)
#pdf("Linear regression of tetraconazole 2 ppm.pdf")   
# Linear Regression graph of EC50 and EC50DC
ggplot(final.tetraconazole.DC.2,
       aes(x = Estimate.50, y = Estimate.50DC)) +  theme(
         plot.title = element_text(
        size = 14, 
        face = "bold", 
        hjust = 1,
        family = "Verdana"
        ),
        axis.title = element_text(size = 14, face = "bold", hjust = 0.5),
        axis.text = element_text(
          face = "bold",
          size= 14,
          family= "Verdana"
          ),
        panel.background = element_rect(fill = "white",colour = "grey50")) + labs(title= "Linear regression between EC50 and EC50(D) values of Tetraconazole", x =
       "EC50 (ppm)", y = "EC50(D) (ppm)") + geom_point(shape=21) + geom_smooth(method = "lm")
        
       



```
#  Tetraconazole With Survey(Pre-Test Fungicide) included Farmer fields and Fungicide field trials
```{r}
tetraconazole.data <- survey.data.3 %>%
  select(ID,
  repeats,
  experimental_replicate,
  tetraconazole.growth,
  control.growth) %>%
  rename(response = tetraconazole.growth, control = control.growth) %>% 
  mutate(ID = as.character(ID))
 
###
amibae <-  tetraconazole.filtered %>% filter(dose== 2 | dose== 0) %>%  spread(dose, response) %>% rename(control= '0',  response = '2') %>% select(ID, repeats, experimental_replicate,  response,control ) %>% 
    mutate(ID = as.character(ID))



## That was using the EC50D of the serial dilution but Iam going to use Real EC50 of those
 


# Using the function in order to take out the outliers#
tetraconazole.filtered.survey <- tetraconazole.data %>%
  group_by(ID) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  mutate(control_range = list(get_range(control))) %>%
  unnest() %>%
  filter(response <= upper & response >= lower, control <= upper1 & control >= lower1) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, repeats, response, control))

##PLus baseline
tetraconazole.filtered. <- tetraconazole.filtered.survey %>%
  group_by(ID) %>% 
  summarise(mean_response =mean(response, na.rm = TRUE), mean_control =mean(control, na.rm = TRUE)) %>% 
  mutate(RG= (mean_response/mean_control)*100) %>% 
  mutate(Estimate.50DC = exp (finalRG2[[1]][[1]] + finalRG2[[1]][[2]]*RG)) %>% 
select(c(ID, Estimate.50DC)) %>% 
  ungroup()



```
##  Analysis by fungicide
#  Thiophanate methyl
```{r}
TM.filtered <- TMdata %>%
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>%
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>% 
  ungroup() 
  

## Discarding all experimental replicate 1 due not consistence in results## anyways it was not consistence in those ones
TM.filtered <- TM.filtered %>%
  group_by (ID, dose, repeats, response) %>%
  filter(experimental_replicate==2 | experimental_replicate==3)

zz <- EC_table(TM.filtered, form = response ~ dose)
 RG <- TM.filtered %>% group_by(ID,dose) %>% summarise(mean_response=mean(response,na.rm=TRUE)) %>% spread(dose,mean_response) %>%  mutate(RG0.75=((`0.75`/`0`)*100)) %>% mutate(RG1=((`1`/`0`)*100)) %>% mutate(RG1.5=((`1.5`/`0`)*100)) %>% mutate(RG2=((`2`/`0`)*100)) %>% mutate(RG2.5=((`2.5`/`0`)*100)) %>%  mutate(RG10=((`10`/`0`)*100))
# 
#Since here EC50 is known as Estimate EC50 from EC50 table 
 
# #Ordering the table

TM.zz <-   zz%>% rename(ID = sample ) %>%
  rename(EC50 = Estimate.50)%>%
  select(c("ID", "EC50")) %>%  group_by(ID, EC50) %>% mutate(group = ifelse(
    ID %in% baseline_isolates,
    "baseline",
    ifelse(
    ID %in% survey_isolates,
    "survey_isolates",
    "treatmentyear2016_isolates"
    )
    )) %>% ungroup() %>% mutate(fungicide = "TM") %>% mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group))

 final.TM<-left_join (RG, TM.zz) %>% mutate(logEC50=(log(EC50))) 

 
 
#Dose chosen as DD
# Linear model of log EC50 and relative growth at 10 ppm, check normality and homogeneity of variances
finalRG10<- lm(logEC50~RG10,final.TM) 
summary(finalRG10)
plot(finalRG10)
#check_assumptions(finalRG2.5)
    # Linear Regression graph of log EC50 and relative growth at 10 ppm
ggplot(finalRG10, aes(x = RG10, y = logEC50)) +  geom_point() + geom_smooth()

# Getting the EC50DD according to the model

final.TM.DD <- final.TM %>% mutate(Estimate.50DD = exp(finalRG10[[1]][[1]] - finalRG10[[1]][[2]]*RG10))
# Linear model of EC50  and EC50DD, check normality and homogeneity of variances
final.TM.DD.10 <- lm (Estimate.50DD ~ EC50, final.TM.DD)
summary(final.TM.DD.10)
plot(final.TM.DD.10)
#check_assumptions(final_TM_DD_10)
#pdf("Linear regression of thiophanate methyl 10 ppm.pdf")   
## Linear Regression graph of EC50 and EC50DD
ggplot(final.TM.DD.10, aes(x = EC50, y = Estimate.50DD)) +  theme(plot.title = element_text(size = 16, face = "bold", hjust = 1)) + labs(title = "Linear regression of thiophanate methyl 10 ppm", x ="EC50 (ppm)", y = "EC50DD (ppm)" ) + geom_point() + geom_smooth(method = "lm")



```
#  Thiophanate methyl with Survey(Pre-Test Fungicide)
```{r}
TM.data <- survey.data.3 %>%
  select(ID, repeats, experimental_replicate, TM.growth, control.growth) %>% 
  rename(response = TM.growth, control = control.growth)%>%  
  mutate(ID= as.character(ID))

TM.data <- TM.data %>% 
  group_by(ID) %>% 
  summarise(mean_response =mean(response, na.rm = TRUE), mean_control =mean(control, na.rm = TRUE)) %>% 
  mutate(RG= (mean_response/mean_control)*100)  %>% 
mutate(resistance = ifelse(RG >24,#more or equal to 25%, 
                           "resistant", "nonresistant")) 


```
#  Another approach with TM to pick the probably isolates with high at EC50 of the model with the best model
```{r}
# Picking the best fit model

TM.filtered <- TMdata %>%
  group_by(ID, dose) %>%
  mutate(growth_range = list(get_range(growth))) %>%
  unnest() %>%
  filter(growth <= upper & growth >= lower) %>%
  rename(response = growth) %>% 
  ungroup()

## Discarding all experimental replicate 1 due not consistence in results## anyways it was not consistence in those ones
TM.filtered1 <- TM.filtered %>%
  group_by (ID, dose, repeats, response) %>%
  filter(experimental_replicate==2 | experimental_replicate==3)

zz1 <- EC_table(TM.filtered1, form = response ~ dose)

TM.zz1 <-   zz1%>% rename(ID = sample )%>%
 rename(EC50 = Estimate.50)%>%
  select(c("ID", "EC50")) %>%  group_by(ID, EC50) %>% mutate(group = ifelse(
    ID %in% baseline_isolates,
    "baseline",
    ifelse(
    ID %in% survey_isolates,
    "survey_isolates",
    "treatmentyear2016_isolates"
    )
    )) %>% ungroup() %>% mutate(fungicide = "TM") %>% mutate(group = recode(group, survey_isolates = "Farmer fields", treatmentyear2016_isolates = "Fungicide field trials", baseline = "Baseline")) %>% mutate(group = as.factor(group))

 

#Procedure to get Discriminatory conecntration


 RG <- TM.filtered1 %>% group_by(ID,dose) %>% summarise(mean_response=mean(response,na.rm=TRUE)) %>% spread(dose,mean_response) %>%  mutate(RG0.75=((`0.75`/`0`)*100)) %>% mutate(RG1=((`1`/`0`)*100)) %>% mutate(RG1.5=((`1.5`/`0`)*100)) %>% mutate(RG2=((`2`/`0`)*100)) %>% mutate(RG2.5=((`2.5`/`0`)*100)) %>% 
   mutate(RG10=((`10`/`0`)*100))
# 
#Since here EC50 is known as Estimate EC50 from EC50 table 
 

final.TM1<-left_join (RG, TM.zz1) %>% mutate(logEC50=(log(EC50))) 

 #Dose chosen as  potential DD

# Linear model of log EC50 and relative growth at 2.5 ppm, check normality and homogeneity of variances

finalRG2.5.1<- lm(logEC50~RG2.5,final.TM1) 
summary(finalRG2.5.1)
plot(finalRG2.5.1)
#check_assumptions(finalRG2.5)
      # Linear Regression graph of log EC50 and relative growth at 2.5 ppm
ggplot(finalRG2.5.1, aes(x = RG2.5, y = logEC50)) +  geom_point() + geom_smooth()


# Getting the EC50DD according to the model
final.TM.DD1 <- final.TM1 %>% mutate(Estimate.50DD = exp(finalRG2.5.1[[1]][[1]] + finalRG2.5.1[[1]][[2]]*RG2.5))
# Linear model of EC50  and EC50DD, check normality and homogeneity of variances
final.TM.DD.2.5 <- lm (Estimate.50DD ~ EC50, final.TM.DD1)
summary(final.TM.DD.2.5)
plot(final.TM.DD.2.5)
#check_assumptions(final_TM_DD_10)
#pdf("Linear regression of thiophanate methyl 10 ppm.pdf")   
## Linear Regression graph of EC50 and EC50DD
ggplot(final.TM.DD.2.5, aes(x = EC50, y = Estimate.50DD)) +  theme(plot.title = element_text(size = 16, face = "bold", hjust = 1)) + labs(title = "Linear regression of thiophanate methyl 10 ppm", x ="EC50 (ppm)", y = "EC50DD (ppm)" ) + geom_point() + geom_smooth(method = "lm")

#dev.off()

#TM WITH SURVEY(PRE-TEST FUNGICIDE)


TM.data <- survey.data.3 %>%
  select(ID, repeats, experimental_replicate, TM.growth, control.growth) %>% 
  rename(response = TM.growth, control = control.growth)%>%
  mutate(ID= as.character(ID))

# Using the function in order to take out the outliers#
TM.data.filtered.survey <- TM.data %>%
  group_by(ID) %>%
  mutate(response_range = list(get_range(response))) %>%
  unnest() %>%
  mutate(control_range = list(get_range(control))) %>%
  unnest() %>%
  filter(response <= upper & response >= lower, control <= upper1 & control >= lower1) %>%
  ungroup()%>% 
  select(c(ID, experimental_replicate, repeats, response, control))

##USind the model
TM.filtered. <- TM.data.filtered.survey %>%
  group_by(ID) %>% 
  summarise(mean_response =mean(response, na.rm = TRUE), mean_control =mean(control, na.rm = TRUE)) %>% 
  mutate(RG= (mean_response/mean_control)*100) %>% 
  mutate(Estimate.50DC = exp (finalRG2.5.1[[1]][[1]] + finalRG2.5.1[[1]][[2]]*RG)) %>% 
select(c(ID, Estimate.50DC)) %>% 
  ungroup()



  

```
##  Ordering for each fungicide
```{r}
boscalid.xx2 <- boscalid.xx %>% 
  select(ID, EC50)
#No more this
# final_boscalid_DC <- final_boscalid_DC %>% select(ID, Estimate.50DC)
####WATCH OUT, Iam naming EC50 although for boscalide filtered realy is EC50D
boscalid.filtered.2 <- boscalid.filtered. %>% 
rename( EC50 =  Estimate.50DC) %>% 
  mutate(ID = as.numeric(ID))
boscalid.complete <-  rbind.data.frame(boscalid.xx2, boscalid.filtered.2)
boscalid.complete <- ungroup(boscalid.complete)
boscalid.complete$ID <- as.numeric(as.character(boscalid.complete$ID) ) 
baby <- boscalid.complete$ID[duplicated(boscalid.complete$ID)]

#now I will take these repeats from the DC test coming

boscalid.filtered.3 <- boscalid.filtered.2 %>% filter(!ID %in% baby )

#Now substitute
boscalid.complete.2 <-  rbind.data.frame(boscalid.xx2, boscalid.filtered.3)
##look for repetition#
 boscalid.complete.2$ID[duplicated(boscalid.complete.2$ID)]

boscalid.complete.3 <- boscalid.complete.2 %>% 
    mutate(Origin = ifelse(
    ID %in% baseline_isolates,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host))


 #####PICOXYSTROBIN##
picoxystrobin.yy2 <- picoxystrobin.yy %>% 
  select(ID, EC50)
#No more this
# final_picoxystrobin_DC <- final_picoxystrobin_DC %>% select(ID, Estimate.50DC)
####WATCH OUT, Iam naming EC50 although for picoxystrobine filtered realy is EC50D
picoxystrobin.filtered.2 <- picoxystrobin.filtered. %>% 
rename( EC50 =  Estimate.50DC) %>% 
  mutate(ID = as.numeric(ID))
picoxystrobin.complete <-  rbind.data.frame(picoxystrobin.yy2, picoxystrobin.filtered.2)
picoxystrobin.complete <- ungroup(picoxystrobin.complete)
picoxystrobin.complete$ID <- as.numeric(as.character(picoxystrobin.complete$ID) ) 
balon <- picoxystrobin.complete$ID[duplicated(picoxystrobin.complete$ID)]

#now I will take these repeats from the DC test coming

picoxystrobin.filtered.3 <- picoxystrobin.filtered.2 %>% filter(!ID %in% balon )

#Now substitute
picoxystrobin.complete.2 <-  rbind.data.frame(picoxystrobin.yy2, picoxystrobin.filtered.3)
##look for repetition#
 picoxystrobin.complete.2$ID[duplicated(picoxystrobin.complete.2$ID)]

picoxystrobin.complete.3 <- picoxystrobin.complete.2 %>% 
    mutate(Origin = ifelse(
    ID %in% baseline_isolates,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host))



 
#######TETRACONAZOLE##
 
 tetraconazole.bb2 <- tetraconazole.bb %>% 
  select(ID, EC50)
#No more this
# final_tetraconazole_DC <- final_tetraconazole_DC %>% select(ID, Estimate.50DC)
####WATCH OUT, Iam naming EC50 although for tetraconazolee filtered realy is EC50D
tetraconazole.filtered.2 <- tetraconazole.filtered. %>% 
rename( EC50 =  Estimate.50DC) %>% 
  mutate(ID = as.numeric(ID))
tetraconazole.complete <-  rbind.data.frame(tetraconazole.bb2, tetraconazole.filtered.2)
tetraconazole.complete <- ungroup(tetraconazole.complete)
tetraconazole.complete$ID <- as.numeric(as.character(tetraconazole.complete$ID) ) 
casa <- tetraconazole.complete$ID[duplicated(tetraconazole.complete$ID)]

#now I will take these repeats from the DC test coming

tetraconazole.filtered.3 <- tetraconazole.filtered.2 %>% filter(!ID %in% casa )

#Now substitute
tetraconazole.complete.2 <-  rbind.data.frame(tetraconazole.bb2, tetraconazole.filtered.3)
##look for repetition#
 tetraconazole.complete.2$ID[duplicated(tetraconazole.complete.2$ID)]

tetraconazole.complete.3 <- tetraconazole.complete.2 %>% 
    mutate(Origin = ifelse(
    ID %in% baseline_isolates,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host))



##TM#######
    TM.zz2 <- TM.zz%>% 
  select(ID, EC50)
#No more this
# final_boscalid_DC <- final_boscalid_DC %>% select(ID, Estimate.50DC)
####WATCH OUT, Iam naming EC50 although for boscalide filtered realy is EC50D
TM.filtered.2 <- TM.filtered. %>% 
rename( EC50 =  Estimate.50DC) %>% 
  mutate(ID = as.numeric(ID))
TM.complete <-  rbind.data.frame(TM.zz2, TM.filtered.2)
TM.complete <- ungroup(TM.complete)
TM.complete$ID <- as.numeric(as.character(TM.complete$ID) ) 
poste <- TM.complete$ID[duplicated(TM.complete$ID)]

#now I will take these repeats from the DC test coming

TM.filtered.3 <- TM.filtered.2 %>% filter(!ID %in% poste )

#Now substitute
TM.complete.2 <-  rbind.data.frame(TM.zz2, TM.filtered.3)
##look for repetition#
 TM.complete.2$ID[duplicated(TM.complete.2$ID)]

TM.complete.3 <- TM.complete.2 %>% 
    mutate(Origin = ifelse(
    ID %in% baseline_isolates,
    "Baseline",
    ifelse(
      ID %in% Farmer_fields,
      "FF","FFT"
    )), Host = ifelse(
    ID %in% drybean,
    "Drybean", ifelse(
      ID %in% soybean,
      "Soybean","different_host"
    ))) %>% 
    mutate(Origin = as.factor(Origin), Host= as.factor(Host))



```
# ANOVA
```{r}
###########Boscalid
#taking out "different host"

 boscalid.complete.4 <-  boscalid.complete.3 %>% filter(!ID == 8,!ID == 129 )
##NORMALITY TEST-Shapiro_test

shapiro.test.boscal <- boscalid.complete.4 %>%
  group_by(Origin) %>%
  do(tidy(shapiro.test(.$EC50)))
shapiro.test.boscal 
# No normals
shapiro.test.boscal.2 <- boscalid.complete.4 %>%
  group_by(Host) %>%
  do(tidy(shapiro.test(.$EC50)))
shapiro.test.boscal.2

 #NO NORMALILTY thats is why  krusKal
#by origin

kruskal.test(EC50 ~ Origin, data = boscalid.complete.4)

#There is difference p-value = 1.25 *10 -05

DunnTest(EC50 ~ Origin, data = boscalid.complete.4, method = "bonferroni")
#P VALUE 0.00057 *** FF-Baseline
#P VALUE 0.00093 *** FFT-FF


#by hosts

kruskal.test(EC50 ~ Host, data = boscalid.complete.4)
#There is NO difference p-value 0.06043



####### pico
 picoxystrobin.complete.4 <-  picoxystrobin.complete.3 %>% filter(!ID == 8,!ID == 129 )

##NORMALITY TEST-Shapiro_test

shapiro.test.pico <-picoxystrobin.complete.4 %>%
  group_by(Origin) %>%
  do(tidy(shapiro.test(.$EC50)))
shapiro.test.pico 
  ##NO normals
shapiro.test.pico.2 <-picoxystrobin.complete.4 %>%
  group_by(Host) %>%
  do(tidy(shapiro.test(.$EC50)))
shapiro.test.pico.2

 #NO NORMALILTY thats is why  krusKal
#by origin

kruskal.test(EC50 ~ Origin, data = picoxystrobin.complete.4)

#There is NO difference p-value = 0.3702


#by hosts

kruskal.test(EC50 ~ Host, data = picoxystrobin.complete.4)
#There is NO difference p-value 0.6842






#########tetra
 tetraconazole.complete.4 <-  tetraconazole.complete.3 %>% filter(!ID == 8,!ID == 129 )

##NORMALITY TEST-Shapiro_test

shapiro.test.tetra <- tetraconazole.complete.4 %>%
  group_by(Origin) %>%
  do(tidy(shapiro.test(.$EC50)))
shapiro.test.tetra 
# No normals
shapiro.test.tetra.2 <- tetraconazole.complete.4 %>%
  group_by(Host) %>%
  do(tidy(shapiro.test(.$EC50)))
shapiro.test.tetra.2

 #NO NORMALILTY thats is why  krusKal
#by origin

kruskal.test(EC50 ~ Origin, data = tetraconazole.complete.4)

#There NO difference p-value = 0.05979




#by hosts

kruskal.test(EC50 ~ Host, data = tetraconazole.complete.4)
#There is NO difference p-value 0.4241




```

##  Boscalid Plots
```{r}
plot.bos <- boscalid.complete.4%>%
  ggplot(aes(x = Origin, y = EC50)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chartreuse2",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Origin", y = "EC50 (ppm)") + theme(
    panel.border = element_rect(colour = "black", fill=NA, size=1),
    axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50" )
  )

plot.bos

plot.pico <- picoxystrobin.complete.4%>%
  ggplot(aes(x = Origin, y = EC50)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chocolate1",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs(x = "Origin", y = "EC50 (ppm)") + theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.pico


plot.tetra <- tetraconazole.complete.4%>%
  ggplot(aes(x = Origin, y = EC50)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "deepskyblue",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Origin", y = "EC50 (ppm)") + theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.tetra

```

#  Different grouping plots
##  Boscalid
```{r}
plot.bos.2 <- boscalid.complete.4%>%
  ggplot(aes(x = Host, y = EC50)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chartreuse2",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Group", y = "EC50 (ppm)") + theme(
    panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.bos.2

plot.pico.2 <- picoxystrobin.complete.4%>%
  ggplot(aes(x = Host, y = EC50)) +
  geom_jitter(
    width = .1,
    height = 0,
    shape = 21,
    color = "black",
    fill = "chocolate1",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Group", y = "EC50 (ppm)") + theme(
    panel.border = element_rect(colour = "black", fill=NA, size=1),
        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.pico.2


plot.tetra.2 <- tetraconazole.complete.4%>%
  ggplot(aes(x = Host, y = EC50)) +
  geom_jitter(
    width = .1,
    height = 0.5,
    shape = 21,
    color = "black",
    fill = "deepskyblue",
    size = 2,
    alpha = 3 / 4
  ) + stat_summary(
    fun.y = mean,
    geom = "point",
    shape = 95,
    size = 22,
    color = "black"
  ) +
  theme_minimal() +
  labs( x = "Group", y = "EC50 (ppm)") + theme(
        panel.border = element_rect(colour = "black", fill=NA, size=1),

        axis.title = element_text(size = 10, face = "bold", hjust = 0.5),
    axis.text = element_text(
      face = "bold",
      size = 7,
      family = "Verdana"
    ),
    panel.background = element_rect(fill = "white", colour = "grey50")
  )
plot.tetra.2

```
# Using the function to detect outliers considered since the third quantil

```{r}
 #New function to detect outliers of EC50DC en each group for fungicide. These ouliers are considered as equal to the third quantil, i.e. the second max stats
                                                              
 get_range2 <- function(myoutlier) {
  alpha <- boxplot.stats(myoutlier)
  necrosis <- alpha$stats
  wilt <- max(necrosis[necrosis!=max(necrosis)])
    return(data.frame(outlier = wilt))
}           
```

```{r}
summary.field.original <- WM3 %>% 
  select(Field, ID) %>% 
  unique() %>% 
  group_by(Field) %>% 
  summarize(Num_original_isolates = n()) %>% 
  mutate(Empty_field = (Field == "")) %>% 
  filter(Empty_field == FALSE) %>% 
  select(-Empty_field)  

boscalid.complete.5<- boscalid.complete.4%>% 
group_by(Origin)%>%
mutate(Estimate_50DC_outlier = list(get_range2(EC50)))%>%
unnest() %>% 
filter(EC50 >=  outlier) %>% ungroup()

# field.ID.data.boscalid <- boscalid.complete.5 %>% 
#   left_join(WM3, by = c(ID = "Collection_ID", Origin, Host )) %>% 
#   rename(Origin = "Origin.x") %>%     select(colnames(data_for_plots_bos2), Field,  Year, State, molecule.s._current_season, Host) %>% 
#   left_join(summary_field_original)  %>% 
#   mutate(molecule.s._current_season = na_if(molecule.s._current_season, "")) %>% 
#     arrange(ID) %>% rename(Funcide = molecule.s._current_season) %>% 
#   arrange(ID)  %>% 
#   rename(N_iso_perfield =Num_original_isolates) %>%   select(-c(outlier, Estimate.50DC) )
# #first transforming ID variable to charater and then to numeric
# field_ID_data_boscalid$ID <- as.numeric(  as.character(field_ID_data_boscalid$ID))


```

